{"version":3,"sources":["webpack://bluebutton/webpack/universalModuleDefinition","webpack://bluebutton/webpack/bootstrap","webpack://bluebutton/./lib/core.js","webpack://bluebutton/./lib/parsers/generic.js","webpack://bluebutton/./lib/parsers/ccda/demographics.js","webpack://bluebutton/./lib/core/common.js","webpack://bluebutton/external \"ejs\"","webpack://bluebutton/./lib/parsers/ccdar2/health_concerns.js","webpack://bluebutton/./lib/bluebutton.js","webpack://bluebutton/./lib/core/codes.js","webpack://bluebutton/./lib/core/xml.js","webpack://bluebutton/(webpack)/buildin/global.js","webpack://bluebutton/external \"xmldom\"","webpack://bluebutton/./lib/documents.js","webpack://bluebutton/./lib/documents/c32.js","webpack://bluebutton/./lib/documents/ccd.js","webpack://bluebutton/./lib/documents/ccda.js","webpack://bluebutton/./lib/documents/ccdar2.js","webpack://bluebutton/./lib/generators.js","webpack://bluebutton/./lib/generators/c32.js","webpack://bluebutton/./lib/generators/ccda.js","webpack://bluebutton/external \"lodash\"","webpack://bluebutton/./lib/parsers.js","webpack://bluebutton/./lib/parsers/c32.js","webpack://bluebutton/./lib/parsers/c32/allergies.js","webpack://bluebutton/./lib/parsers/c32/demographics.js","webpack://bluebutton/./lib/parsers/c32/document.js","webpack://bluebutton/./lib/parsers/c32/encounters.js","webpack://bluebutton/./lib/parsers/c32/immunizations.js","webpack://bluebutton/./lib/parsers/c32/medications.js","webpack://bluebutton/./lib/parsers/c32/problems.js","webpack://bluebutton/./lib/parsers/c32/procedures.js","webpack://bluebutton/./lib/parsers/c32/results.js","webpack://bluebutton/./lib/parsers/c32/vitals.js","webpack://bluebutton/./lib/parsers/ccd.js","webpack://bluebutton/./lib/parsers/ccd/document.js","webpack://bluebutton/./lib/parsers/ccda.js","webpack://bluebutton/./lib/parsers/ccda/allergies.js","webpack://bluebutton/./lib/parsers/ccda/care_plan.js","webpack://bluebutton/./lib/parsers/ccda/document.js","webpack://bluebutton/./lib/parsers/ccda/encounters.js","webpack://bluebutton/./lib/parsers/ccda/free_text.js","webpack://bluebutton/./lib/parsers/ccda/functional_statuses.js","webpack://bluebutton/./lib/parsers/ccda/immunizations.js","webpack://bluebutton/./lib/parsers/ccda/instructions.js","webpack://bluebutton/./lib/parsers/ccda/medications.js","webpack://bluebutton/./lib/parsers/ccda/problems.js","webpack://bluebutton/./lib/parsers/ccda/procedures.js","webpack://bluebutton/./lib/parsers/ccda/results.js","webpack://bluebutton/./lib/parsers/ccda/smoking_status.js","webpack://bluebutton/./lib/parsers/ccda/vitals.js","webpack://bluebutton/./lib/parsers/ccdar2.js","webpack://bluebutton/./lib/parsers/ccdar2/document.js"],"names":["Codes","require","XML","stripWhitespace","module","exports","parseData","json","trim","source","charAt","parse","e","console","log","JSON","error","datePad","number","replacerFn","key","value","originalValue","Date","isNaN","getTime","_parsedWithTimeData","getHours","getMinutes","getSeconds","getMilliseconds","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getMonth","getDate","getFullYear","stringify","o","y","x","hasOwnProperty","Object","ccda","data","each","callback","i","length","containsTemplateId","templateId","property","p","allSections","elsByTag","s","code","tag","attr","existingTemplateId","nodeName","split","join","toLowerCase","displayName","text","val","Core","doc","self","demographics","parseDate","parseName","parseAddress","el","section","patient","patient_name_dict","dob","gender","marital_status","maritalStatus","patient_address_dict","home","work","mobile","email","language","race","ethnicity","religion","birthplace_dict","guardian_relationship","guardian_relationship_code","guardian_home","guardian_name_dict","guardian_address_dict","provider_organization","provider_phone","provider_address_dict","name","address","phone","birthplace","state","zip","country","guardian","given","family","relationship","relationship_code","provider","organization","str","replace","health_concerns_document","model","entries","health_concerns","title","entry","entryModel","act","er","id","statusCode","effectiveTime","actModel","effective_time","entry_relationship","ers","erModel","type_code","observations","obs","ob","push","class_code","mood_code","display_name","status","Documents","Generators","Parsers","opts","type","parsedData","parsedDocument","parser","documents","detect","parsers","C32","process","run","CCDA","CCDAR2","CCD","generatorType","template","testingMode","GENDER_MAP","MARITAL_STATUS_MAP","RELIGION_MAP","RACE_ETHNICITY_MAP","ROLE_MAP","PROBLEM_STATUS_MAP","invertKeys","obj","result","keys","lookupFnGenerator","map","reverseLookupFnGenerator","invertedMap","reverseGender","reverseMaritalStatus","reverseReligion","raceEthnicity","reverseRaceEthnicity","role","reverseRole","problemStatus","reverseProblemStatus","wrapElement","wrapElementHelper","currentEl","content","immediateChildTag","boolAttr","isEmpty","els","tagAttrVal","getElementsByTagName","getAttribute","emptyEl","parentNode","contentId","unescapeSpecialChars","attrName","attrVal","rawAttr","html","childNodes","textContent","innerHTML","root","XMLSerializer","serializeToString","tagName","slice","docRoot","ownerDocument","contentTag","createElement","xml","isNode","xmldom","DOMParser","parseFromString","window","ActiveXObject","async","loadXML","documentElement","isBrowser","toString","call","global","document","DOMImplementation","createDocument","getEntries","year","substr","month","parseInt","day","hour","min","secs","utcOffset","_utcOffsetFromString","_toInt","date","UTC","parseTimezoneChunker","parseTokenTimezone","string","possibleTzMatches","match","tzChunk","parts","minutes","argumentForCoercion","coercedNumber","isFinite","Math","floor","ceil","nameEl","prefix","addrEl","street","city","c32","method","ejs","pad","String","helpers","hl7Date","undefined","dateStr","timeStr","escapeSpecialChars","hl7Code","code_system","code_system_name","emptyStringIfFalsy","simpleTag","addressTags","addressDict","tags","nameTags","nameDict","suffix","_","now","render","filename","bb","tagHelpers","codes","AllergiesParser","DemographicsParser","DocumentParser","EncountersParser","ImmunizationsParser","MedicationsParser","ProblemsParser","ProceduresParser","ResultsParser","VitalsParser","ParseGenericInfo","allergiesParser","demographicsParser","encountersParser","immunizationsParser","medicationsParser","problemsParser","proceduresParser","resultsParser","vitalsParser","allergies","encounters","parsedImmunizations","immunizations","administered","immunization_declines","declined","results","medications","problems","procedures","vitals","smoking_status","chief_complaint","care_plan","instructions","functional_statuses","start_date","end_date","reaction_type_name","reaction_type_code","reaction_type_code_system","reaction_type_code_system_name","reaction_name","reaction_code","reaction_code_system","severity","allergen_name","allergen_code","allergen_code_system","allergen_code_system_name","date_range","start","end","reaction","reaction_type","allergen","templates","rootTemplate","secondTemplate","loinc","nonXml","nonXmlNodes","bodyType","nonXmlBody","mediaType","representation","rawText","reference","docType","rootTemplateId","author","name_dict","address_dict","work_phone","documentation_of_list","performers","performer_name_dict","performer_phone","performer_addr","location_name","location_addr_dict","encounter_date","documentation_of","location","code_system_version","translation_name","translation_code","translation_code_system","translation_code_system_name","performer_name","performer_code","performer_code_system","performer_code_system_name","location_dict","findings","findingEls","translation","performer","administeredData","declinedData","product","product_name","product_code","product_code_system","product_code_system_name","lot_number","manufacturer_name","route_name","route_code","route_code_system","route_code_system_name","instructions_text","education_name","education_code","education_code_system","dose_value","dose_unit","dose_quantity","unit","route","education_type","effectiveTimes","schedule_type","schedule_period_value","schedule_period_unit","institutionSpecified","product_original_text","rate_quantity_value","rate_quantity_unit","precondition_name","precondition_code","precondition_code_system","reason_name","reason_code","reason_code_system","vehicle_name","vehicle_code","vehicle_code_system","vehicle_code_system_name","administration_name","administration_code","administration_code_system","administration_code_system_name","prescriber_organization","prescriber_person","rate_quantity","precondition","reason","schedule","period_value","period_unit","vehicle","administration","prescriber","person","age","parseFloat","comment","specimen_name","specimen_code","specimen_code_system","performer_dict","device_name","device_code","device_code_system","specimen","device","panel_date","panel_name","panel_code","panel_code_system","panel_code_system_name","observation","tests","tests_data","reference_range_text","reference_range_low_unit","reference_range_low_value","reference_range_high_unit","reference_range_high_value","reference_range","low_unit","low_value","high_unit","high_value","entry_date","results_data","j","HealthConcernsParser","documentParser","healthConcernsParser","CarePlanParser","FreeTextParser","FunctionalStatusesParser","InstructionsParser","SmokingStatusParser","carePlanParser","freeTextParser","functionalStatusesParser","instructionsParser","smokingStatusParser","free_text","time","m","d","D","org","orgEl","representedOrganization","sectionName","statuses","sig","social_history"],"mappings":"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","file":"bluebutton.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"bluebutton\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"bluebutton\"] = factory();\n\telse\n\t\troot[\"bluebutton\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\t(function (module) {\n \t\t  if (module.exports\n \t\t    && !module.exports.__esModule\n \t\t    && module.exports.default === undefined\n \t\t  ) {\n \t\t    if (module.exports.headers\n \t\t      && module.exports.headers.common\n \t\t      && module.exports.headers.common.Accept\n \t\t      && module.exports.adapter\n \t\t      && module.exports.transformRequest\n \t\t      && module.exports.transformResponse\n \t\t    ) {\n \t\t      return;\n \t\t    }\n \t\t    module.exports.default = module.exports;\n \t\t  }\n \t\t})(module);\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","/*\n * ...\n */\n\nvar Codes = require('./core/codes');\nvar XML = require('./core/xml');\nvar { stripWhitespace } = require('./core/common');\n\n/* exported Core */\nmodule.exports = {\n  parseData: parseData,\n  stripWhitespace: stripWhitespace,\n  json: json,\n  trim: trim,\n  Codes: Codes,\n  XML: XML\n};\n/*\n  * ...\n  */\nfunction parseData(source) {\n  source = stripWhitespace(source);\n  \n  if (source.charAt(0) === '<') {\n    try {\n      return XML.parse(source);\n    } catch (e) {\n      if (console.log) {\n        console.log(\"File looked like it might be XML but couldn't be parsed.\");\n      }\n    }\n  }\n\n  try {\n    return JSON.parse(source);\n  } catch (e) {\n    if (console.error) {\n      console.error(\"Error: Cannot parse this file. BB.js only accepts valid XML \" +\n        \"(for parsing) or JSON (for generation). If you are attempting to provide \" +\n        \"XML or JSON, please run your data through a validator to see if it is malformed.\\n\");\n    }\n    throw e;\n  }\n};\n\n/*\n  * A wrapper around JSON.stringify which allows us to produce customized JSON.\n  *\n  * See https://developer.mozilla.org/en-US/docs/Web/\n  *        JavaScript/Guide/Using_native_JSON#The_replacer_parameter\n  * for documentation on the replacerFn.\n  */\nfunction json() {\n\n  var datePad = function(number) {\n    if (number < 10) {\n      return '0' + number;\n    }\n    return number;\n  };\n  \n  var replacerFn = function(key, value) {\n    /* By default, Dates are output as ISO Strings like \"2014-01-03T08:00:00.000Z.\" This is\n      * tricky when all we have is a date (not a datetime); JS sadly ignores that distinction.\n      *\n      * To paper over this JS wart, we use two different JSON formats for dates and datetimes.\n      * This is a little ugly but makes sure that the dates/datetimes mostly just parse\n      * correclty for clients:\n      *\n      * 1. Datetimes are rendered as standard ISO strings, without the misleading millisecond\n      *    precision (misleading because we don't have it): YYYY-MM-DDTHH:mm:ssZ\n      * 2. Dates are rendered as MM/DD/YYYY. This ensures they are parsed as midnight local-time,\n      *    no matter what local time is, and therefore ensures the date is always correct.\n      *    Outputting \"YYYY-MM-DD\" would lead most browsers/node to assume midnight UTC, which\n      *    means \"2014-04-27\" suddenly turns into \"04/26/2014 at 5PM\" or just \"04/26/2014\"\n      *    if you format it as a date...\n      *\n      * See http://stackoverflow.com/questions/2587345/javascript-date-parse and\n      *     http://blog.dygraphs.com/2012/03/javascript-and-dates-what-mess.html\n      * for more on this issue.\n      */\n    var originalValue = this[key]; // a Date\n\n    if ( value && (originalValue instanceof Date) && !isNaN(originalValue.getTime()) ) {\n\n      // If while parsing we indicated that there was time-data specified, or if we see\n      // non-zero values in the hour/minutes/seconds/millis fields, output a datetime.\n      if (originalValue._parsedWithTimeData ||\n          originalValue.getHours() || originalValue.getMinutes() ||\n          originalValue.getSeconds() || originalValue.getMilliseconds()) {\n\n        // Based on https://developer.mozilla.org/en-US/docs/Web/JavaScript/\n        //    Reference/Global_Objects/Date/toISOString\n        return originalValue.getUTCFullYear() +\n          '-' + datePad( originalValue.getUTCMonth() + 1 ) +\n          '-' + datePad( originalValue.getUTCDate() ) +\n          'T' + datePad( originalValue.getUTCHours() ) +\n          ':' + datePad( originalValue.getUTCMinutes() ) +\n          ':' + datePad( originalValue.getUTCSeconds() ) +\n          'Z';\n      }\n      \n      // We just have a pure date\n      return datePad( originalValue.getMonth() + 1 ) +\n        '/' + datePad( originalValue.getDate() ) +\n        '/' + originalValue.getFullYear();\n\n    }\n\n    return value;\n  };\n  \n  return JSON.stringify(this, replacerFn, 2);\n};\n\n\n/*\n  * Removes all `null` properties from an object.\n  */\nfunction trim(o) {\n  var y;\n  for (var x in o) {\n    if (o.hasOwnProperty(x)) {\n      y = o[x];\n      // if (y === null || (y instanceof Object && Object.keys(y).length == 0)) {\n      if (y === null) {\n        delete o[x];\n      }\n      if (y instanceof Object) y = trim(y);\n    }\n  }\n  return o;\n};\n","/* Parses out basic data about each section */\n\nmodule.exports = function (ccda, data) {\n\n    var each = function (callback) {\n        for (var i = 0; i < this.length; i++) {\n            callback(this[i]);\n        }\n    };\n\n    var containsTemplateId = function(templateId, data) {\n        for (var property in data) {\n            if (data.hasOwnProperty(property)) {\n                var p = data[property].templateId;\n                //var display = this[property].displayName;\n                if(p) {\n                    if(p === templateId) {\n                        //console.log(\"TemplateId Match \" + templateId + \" \" + display);\n                        return true;\n                    }\n                }\n            }\n        }\n        return false;\n    };\n\n    var allSections = ccda.elsByTag('section');\n    allSections.each = each;\n\n    allSections.each(function(s) {\n\n        var code = s.tag('code').attr('displayName');\n        var templateId =  s.tag('templateId').attr('root');\n\n        var existingTemplateId = containsTemplateId(templateId, data);\n\n        if (code) {\n            var nodeName = code.split(' ').join('_').toLowerCase();\n\n            //console.log(\"NODE NAME \" + nodeName);\n\n            if (!data[nodeName] && !existingTemplateId) {\n                //console.log(\"CREATE NODE \" + code);\n                data[nodeName] = {};\n            }\n\n            if(data[nodeName]) {\n                data[nodeName].displayName = code;\n                data[nodeName].templateId = templateId;\n                data[nodeName].text = s.tag('text').val(true);\n            }\n\n        }\n    });\n};","/*\n * Parser for the CCDA demographics section\n */\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.demographics = demographics;\n\n  function demographics(ccda) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var data = {}, el;\n    \n    var demographics = ccda.section('demographics');\n    \n    var patient = demographics.tag('patientRole');\n    el = patient.tag('patient').tag('name');\n    var patient_name_dict = parseName(el);\n    \n    el = patient.tag('patient');\n    var dob = parseDate(el.tag('birthTime').attr('value')),\n        gender = Core.Codes.gender(el.tag('administrativeGenderCode').attr('code')),\n        marital_status = Core.Codes.maritalStatus(el.tag('maritalStatusCode').attr('code'));\n    \n    el = patient.tag('addr');\n    var patient_address_dict = parseAddress(el);\n    \n    el = patient.tag('telecom');\n    var home = el.attr('value'),\n        work = null,\n        mobile = null;\n    \n    var email = null;\n    \n    var language = patient.tag('languageCommunication').tag('languageCode').attr('code'),\n        race = patient.tag('raceCode').attr('displayName'),\n        ethnicity = patient.tag('ethnicGroupCode').attr('displayName'),\n        religion = patient.tag('religiousAffiliationCode').attr('displayName');\n    \n    el = patient.tag('birthplace');\n    var birthplace_dict = parseAddress(el);\n    \n    el = patient.tag('guardian');\n    var guardian_relationship = el.tag('code').attr('displayName'),\n        guardian_relationship_code = el.tag('code').attr('code'),\n        guardian_home = el.tag('telecom').attr('value');\n    \n    el = el.tag('guardianPerson').tag('name');\n    var guardian_name_dict = parseName(el);\n    \n    el = patient.tag('guardian').tag('addr');\n    var guardian_address_dict = parseAddress(el);\n    \n    el = patient.tag('providerOrganization');\n    var provider_organization = el.tag('name').val(),\n        provider_phone = el.tag('telecom').attr('value');\n    \n    var provider_address_dict = parseAddress(el.tag('addr'));\n    \n    data = {\n      name: patient_name_dict,\n      dob: dob,\n      gender: gender,\n      marital_status: marital_status,\n      address: patient_address_dict,\n      phone: {\n        home: home,\n        work: work,\n        mobile: mobile\n      },\n      email: email,\n      language: language,\n      race: race,\n      ethnicity: ethnicity,\n      religion: religion,\n      birthplace: {\n        state: birthplace_dict.state,\n        zip: birthplace_dict.zip,\n        country: birthplace_dict.country\n      },\n      guardian: {\n        name: {\n          given: guardian_name_dict.given,\n          family: guardian_name_dict.family\n        },\n        relationship: guardian_relationship,\n        relationship_code: guardian_relationship_code,\n        address: guardian_address_dict,\n        phone: {\n          home: guardian_home\n        }\n      },\n      provider: {\n        organization: provider_organization,\n        phone: provider_phone,\n        address: provider_address_dict\n      }\n    };\n    \n    return data;\n  };\n}","module.exports = {\n  stripWhitespace: stripWhitespace\n}\n\nfunction stripWhitespace (str) {\n    if (!str) { return str; }\n    return str.replace(/^\\s+|\\s+$/g,'');\n};","module.exports = require(\"ejs\");","/*\n * Parser for the CCDAR2 Health Concerns Section\n * 2.16.840.1.113883.10.20.22.2.58\n */\n\nmodule.exports = function(doc) {\n    var self = this;\n    self.doc = doc;\n\n    self.health_concerns_document = function (ccda) {\n        var parseDate = self.doc.parseDate;\n        var parseName = self.doc.parseName;\n        var parseAddress = self.doc.parseAddress;\n    \n        // Helper to create each iterator for collection\n        var each = function (callback) {\n            for (var i = 0; i < this.length; i++) {\n                callback(this[i]);\n            }\n        };\n    \n        var model = {}, el;\n        model.entries = [];\n    \n        model.text = ccda.tag('text').val(true);\n    \n        var health_concerns = ccda.section('health_concerns_document');\n        var title = health_concerns.tag('title').val();\n    \n        health_concerns.entries().each(function(entry) {\n    \n            var entryModel = {};\n            // Parse out the ACT Body\n            //A record of something that is being done, has been done, can be done, or is intended or requested to be done.\n            var act = entry.tag('act');\n            var er = act.elsByTag('entryRelationship');\n            var templateId = act.tag('templateId').attr('root');\n            var id = act.tag('id').attr('root');\n            var statusCode = act.tag('statusCode').attr('code');\n            var code = act.tag('code');\n            var name = code.attr('displayName');\n            var effectiveTime = parseDate(entry.tag('effectiveTime'));\n    \n            // The model we want to return in json\n            var actModel = {\n                effective_time: effectiveTime,\n                name: name,\n                entry_relationship:[]\n            };\n    \n            // Parse Entity Relationship child nodes\n    \n            var ers = entry.elsByTag('entryRelationship');\n            ers.each = each;\n    \n            ers.each(function(er){\n    \n                var erModel = {\n                    type_code : er.attr('typeCode'),\n                    observations : []\n                };\n    \n                var obs = er.elsByTag('observation');\n                obs.each = each;\n    \n                // Parse out Obsevations for Each ER\n                obs.each(function(ob) {\n                    erModel.observations.push({\n                        class_code: ob.attr('classCode'),\n                        mood_code: ob.attr('moodCode'),\n                        display_name : ob.tag('value').attr('displayName'),\n                        status: ob.tag('statusCode').attr('code')\n                    });\n                });\n    \n                actModel.entry_relationship.push(erModel);\n    \n            });\n    \n            // Add ACT Model to our final return model\n            entryModel['act'] = actModel;\n            model.entries.push(entryModel);\n        });\n    \n        return model;\n    };    \n}","'use strict';\n/*\n * ...\n */\n\nvar Core = require('./core');\n\nvar Documents = require('./documents');\n\nvar Generators = require('./generators');\n\nvar Parsers = require('./parsers');\n\n\n/* exported BlueButton */\nmodule.exports = function (source, opts) {\n  var type, parsedData, parsedDocument;\n  \n  // Look for options\n  if (!opts) opts = {};\n  \n  // Detect and parse the source data\n  parsedData = Core.parseData(source);\n  \n  // Detect and parse the document\n  if (opts.parser) {\n    \n    // TODO: parse the document with provided custom parser\n    parsedDocument = opts.parser();\n    \n  } else {\n    var documents = new Documents();\n    type = documents.detect(parsedData);\n    var parsers = new Parsers(documents);\n    switch (type) {\n      case 'c32':\n        parsedData = documents.C32.process(parsedData);\n        parsedDocument = parsers.C32.run(parsedData);\n        break;\n      case 'ccda':\n        parsedData = documents.CCDA.process(parsedData);\n        parsedDocument = parsers.CCDA.run(parsedData);\n        break;\n      case 'ccdar2':\n        parsedData = documents.CCDAR2.process(parsedData);\n        parsedDocument = parsers.CCDAR2.run(parsedData);\n        break;\n      case 'ccd':\n        parsedData = documents.CCD.process(parsedData);\n        parsedDocument = parsers.CCD.run(parsedData);\n        break;\n      case 'json':\n        /* Expects a call like:\n         * BlueButton(json string, {\n         *   generatorType: 'ccda',\n         *   template: < EJS file contents >\n         * })\n         * The returned \"type\" will be the requested type (not \"json\")\n         * and the XML will be turned as a string in the 'data' key\n         */\n        switch (opts.generatorType) {\n          // only the unit tests ever need to worry about this testingMode argument\n          case 'c32':\n            type = 'c32';\n            parsedDocument = Generators.C32.run(parsedData, opts.template, opts.testingMode);\n            break;\n          case 'ccda':\n            type = 'ccda';\n            parsedDocument = Generators.CCDA.run(parsedData, opts.template, opts.testingMode);\n            break;\n        }\n    }\n  }\n  \n  return {\n    type: type,\n    data: parsedDocument,\n    source: parsedData\n  };\n\n};\n","/*\n * ...\n */\n\n\n  \n/*\n  * Administrative Gender (HL7 V3)\n  * http://phinvads.cdc.gov/vads/ViewValueSet.action?id=8DE75E17-176B-DE11-9B52-0015173D1785\n  * OID: 2.16.840.1.113883.1.11.1\n  */\nvar GENDER_MAP = {\n  'F': 'female',\n  'M': 'male',\n  'UN': 'undifferentiated'\n};\n\n/*\n  * Marital Status (HL7)\n  * http://phinvads.cdc.gov/vads/ViewValueSet.action?id=46D34BBC-617F-DD11-B38D-00188B398520\n  * OID: 2.16.840.1.114222.4.11.809\n  */\nvar MARITAL_STATUS_MAP = {\n  'N': 'annulled',\n  'C': 'common law',\n  'D': 'divorced',\n  'P': 'domestic partner',\n  'I': 'interlocutory',\n  'E': 'legally separated',\n  'G': 'living together',\n  'M': 'married',\n  'O': 'other',\n  'R': 'registered domestic partner',\n  'A': 'separated',\n  'S': 'single',\n  'U': 'unknown',\n  'B': 'unmarried',\n  'T': 'unreported',\n  'W': 'widowed'\n};\n\n/*\n  * Religious Affiliation (HL7 V3)\n  * https://phinvads.cdc.gov/vads/ViewValueSet.action?id=6BFDBFB5-A277-DE11-9B52-0015173D1785\n  * OID: 2.16.840.1.113883.5.1076\n  */\nvar RELIGION_MAP = {\n  \"1001\": \"adventist\",\n  \"1002\": \"african religions\",\n  \"1003\": \"afro-caribbean religions\",\n  \"1004\": \"agnosticism\",\n  \"1005\": \"anglican\",\n  \"1006\": \"animism\",\n  \"1061\": \"assembly of god\",\n  \"1007\": \"atheism\",\n  \"1008\": \"babi & baha'i faiths\",\n  \"1009\": \"baptist\",\n  \"1010\": \"bon\",\n  \"1062\": \"brethren\",\n  \"1011\": \"cao dai\",\n  \"1012\": \"celticism\",\n  \"1013\": \"christian (non-catholic, non-specific)\",\n  \"1063\": \"christian scientist\",\n  \"1064\": \"church of christ\",\n  \"1065\": \"church of god\",\n  \"1014\": \"confucianism\",\n  \"1066\": \"congregational\",\n  \"1015\": \"cyberculture religions\",\n  \"1067\": \"disciples of christ\",\n  \"1016\": \"divination\",\n  \"1068\": \"eastern orthodox\",\n  \"1069\": \"episcopalian\",\n  \"1070\": \"evangelical covenant\",\n  \"1017\": \"fourth way\",\n  \"1018\": \"free daism\",\n  \"1071\": \"friends\",\n  \"1072\": \"full gospel\",\n  \"1019\": \"gnosis\",\n  \"1020\": \"hinduism\",\n  \"1021\": \"humanism\",\n  \"1022\": \"independent\",\n  \"1023\": \"islam\",\n  \"1024\": \"jainism\",\n  \"1025\": \"jehovah's witnesses\",\n  \"1026\": \"judaism\",\n  \"1027\": \"latter day saints\",\n  \"1028\": \"lutheran\",\n  \"1029\": \"mahayana\",\n  \"1030\": \"meditation\",\n  \"1031\": \"messianic judaism\",\n  \"1073\": \"methodist\",\n  \"1032\": \"mitraism\",\n  \"1074\": \"native american\",\n  \"1075\": \"nazarene\",\n  \"1033\": \"new age\",\n  \"1034\": \"non-roman catholic\",\n  \"1035\": \"occult\",\n  \"1036\": \"orthodox\",\n  \"1037\": \"paganism\",\n  \"1038\": \"pentecostal\",\n  \"1076\": \"presbyterian\",\n  \"1039\": \"process, the\",\n  \"1077\": \"protestant\",\n  \"1078\": \"protestant, no denomination\",\n  \"1079\": \"reformed\",\n  \"1040\": \"reformed/presbyterian\",\n  \"1041\": \"roman catholic church\",\n  \"1080\": \"salvation army\",\n  \"1042\": \"satanism\",\n  \"1043\": \"scientology\",\n  \"1044\": \"shamanism\",\n  \"1045\": \"shiite (islam)\",\n  \"1046\": \"shinto\",\n  \"1047\": \"sikism\",\n  \"1048\": \"spiritualism\",\n  \"1049\": \"sunni (islam)\",\n  \"1050\": \"taoism\",\n  \"1051\": \"theravada\",\n  \"1081\": \"unitarian universalist\",\n  \"1052\": \"unitarian-universalism\",\n  \"1082\": \"united church of christ\",\n  \"1053\": \"universal life church\",\n  \"1054\": \"vajrayana (tibetan)\",\n  \"1055\": \"veda\",\n  \"1056\": \"voodoo\",\n  \"1057\": \"wicca\",\n  \"1058\": \"yaohushua\",\n  \"1059\": \"zen buddhism\",\n  \"1060\": \"zoroastrianism\"\n};\n\n/*\n  * Race & Ethnicity (HL7 V3)\n  * Full list at http://phinvads.cdc.gov/vads/ViewCodeSystem.action?id=2.16.840.1.113883.6.238\n  * OID: 2.16.840.1.113883.6.238\n  *\n  * Abbreviated list closer to real usage at: (Race / Ethnicity)\n  * https://phinvads.cdc.gov/vads/ViewValueSet.action?id=67D34BBC-617F-DD11-B38D-00188B398520\n  * https://phinvads.cdc.gov/vads/ViewValueSet.action?id=35D34BBC-617F-DD11-B38D-00188B398520\n  */\nvar RACE_ETHNICITY_MAP = {\n  '2028-9': 'asian',\n  '2054-5': 'black or african american',\n  '2135-2': 'hispanic or latino',\n  '2076-8': 'native',\n  '2186-5': 'not hispanic or latino',\n  '2131-1': 'other',\n  '2106-3': 'white'\n};\n\n/*\n  * Role (HL7 V3)\n  * https://phinvads.cdc.gov/vads/ViewCodeSystem.action?id=2.16.840.1.113883.5.111\n  * OID: 2.16.840.1.113883.5.111\n  */\nvar ROLE_MAP = {\n  \"ACC\": \"accident site\",\n  \"ACHFID\":  \"accreditation location identifier\",\n  \"ACTMIL\":  \"active duty military\",\n  \"ALL\": \"allergy clinic\",\n  \"AMB\": \"ambulance\",\n  \"AMPUT\":   \"amputee clinic\",\n  \"ANTIBIOT\":    \"antibiotic\",\n  \"ASSIST\":  \"assistive non-person living subject\",\n  \"AUNT\":    \"aunt\",\n  \"B\":   \"blind\",\n  \"BF\":  \"beef\",\n  \"BILL\":    \"billing contact\",\n  \"BIOTH\":   \"biotherapeutic non-person living subject\",\n  \"BL\":  \"broiler\",\n  \"BMTC\":    \"bone marrow transplant clinic\",\n  \"BMTU\":    \"bone marrow transplant unit\",\n  \"BR\":  \"breeder\",\n  \"BREAST\":  \"breast clinic\",\n  \"BRO\": \"brother\",\n  \"BROINLAW\":    \"brother-in-law\",\n  \"C\":   \"calibrator\",\n  \"CANC\": \"child and adolescent neurology clinic\",\n  \"CAPC\": \"child and adolescent psychiatry clinic\",\n  \"CARD\": \"ambulatory health care facilities; clinic/center; rehabilitation: cardiac facilities\",\n  \"CAS\": \"asylum seeker\",\n  \"CASM\":    \"single minor asylum seeker\",\n  \"CATH\":    \"cardiac catheterization lab\",\n  \"CCO\": \"clinical companion\",\n  \"CCU\": \"coronary care unit\",\n  \"CHEST\":   \"chest unit\",\n  \"CHILD\":   \"child\",\n  \"CHLDADOPT\":   \"adopted child\",\n  \"CHLDFOST\":    \"foster child\",\n  \"CHLDINLAW\":   \"child in-law\",\n  \"CHR\": \"chronic care facility\",\n  \"CLAIM\":   \"claimant\",\n  \"CN\":  \"national\",\n  \"CNRP\":    \"non-country member without residence permit\",\n  \"CNRPM\":   \"non-country member minor without residence permit\",\n  \"CO\":  \"companion\",\n  \"COAG\":    \"coagulation clinic\",\n  \"COCBEN\":  \"continuity of coverage beneficiary\",\n  \"COMM\":    \"community location\",\n  \"COMMUNITYLABORATORY\": \"community laboratory\",\n  \"COUSN\":   \"cousin\",\n  \"CPCA\":    \"permit card applicant\",\n  \"CRIMEVIC\":    \"crime victim\",\n  \"CRP\": \"non-country member with residence permit\",\n  \"CRPM\":    \"non-country member minor with residence permit\",\n  \"CRS\": \"colon and rectal surgery clinic\",\n  \"CSC\": \"community service center\",\n  \"CVDX\":    \"cardiovascular diagnostics or therapeutics unit\",\n  \"DA\":  \"dairy\",\n  \"DADDR\":   \"delivery address\",\n  \"DAU\": \"natural daughter\",\n  \"DAUADOPT\":    \"adopted daughter\",\n  \"DAUC\":    \"daughter\",\n  \"DAUFOST\": \"foster daughter\",\n  \"DAUINLAW\":    \"daughter in-law\",\n  \"DC\":  \"therapeutic class\",\n  \"DEBR\":    \"debridement\",\n  \"DERM\":    \"dermatology clinic\",\n  \"DIFFABL\": \"differently abled\",\n  \"DOMPART\": \"domestic partner\",\n  \"DPOWATT\": \"durable power of attorney\",\n  \"DR\":  \"draft\",\n  \"DU\":  \"dual\",\n  \"DX\":  \"diagnostics or therapeutics unit\",\n  \"E\":   \"electronic qc\",\n  \"ECHO\":    \"echocardiography lab\",\n  \"ECON\":    \"emergency contact\",\n  \"ENDO\":    \"endocrinology clinic\",\n  \"ENDOS\":   \"endoscopy lab\",\n  \"ENROLBKR\":    \"enrollment broker\",\n  \"ENT\": \"otorhinolaryngology clinic\",\n  \"EPIL\":    \"epilepsy unit\",\n  \"ER\":  \"emergency room\",\n  \"ERL\": \"enrollment\",\n  \"ETU\": \"emergency trauma unit\",\n  \"EXCEST\":  \"executor of estate\",\n  \"EXT\": \"extended family member\",\n  \"F\":   \"filler proficiency\",\n  \"FAMDEP\":  \"family dependent\",\n  \"FAMMEMB\": \"family member\",\n  \"FI\":  \"fiber\",\n  \"FMC\": \"family medicine clinic\",\n  \"FRND\":    \"unrelated friend\",\n  \"FSTUD\":   \"full-time student\",\n  \"FTH\": \"father\",\n  \"FTHINLAW\":    \"father-in-law\",\n  \"FULLINS\": \"fully insured coverage sponsor\",\n  \"G\":   \"group\",\n  \"GACH\":    \"hospitals; general acute care hospital\",\n  \"GD\":  \"generic drug\",\n  \"GDF\": \"generic drug form\",\n  \"GDS\": \"generic drug strength\",\n  \"GDSF\":    \"generic drug strength form\",\n  \"GGRFTH\":  \"great grandfather\",\n  \"GGRMTH\":  \"great grandmother\",\n  \"GGRPRN\":  \"great grandparent\",\n  \"GI\":  \"gastroenterology clinic\",\n  \"GIDX\":    \"gastroenterology diagnostics or therapeutics lab\",\n  \"GIM\": \"general internal medicine clinic\",\n  \"GRFTH\":   \"grandfather\",\n  \"GRMTH\":   \"grandmother\",\n  \"GRNDCHILD\":   \"grandchild\",\n  \"GRNDDAU\": \"granddaughter\",\n  \"GRNDSON\": \"grandson\",\n  \"GRPRN\":   \"grandparent\",\n  \"GT\":  \"guarantor\",\n  \"GUADLTM\": \"guardian ad lidem\",\n  \"GUARD\":   \"guardian\",\n  \"GYN\": \"gynecology clinic\",\n  \"HAND\":    \"hand clinic\",\n  \"HANDIC\":  \"handicapped dependent\",\n  \"HBRO\":    \"half-brother\",\n  \"HD\":  \"hemodialysis unit\",\n  \"HEM\": \"hematology clinic\",\n  \"HLAB\":    \"hospital laboratory\",\n  \"HOMEHEALTH\":  \"home health\",\n  \"HOSP\":    \"hospital\",\n  \"HPOWATT\": \"healthcare power of attorney\",\n  \"HRAD\":    \"radiology unit\",\n  \"HSIB\":    \"half-sibling\",\n  \"HSIS\":    \"half-sister\",\n  \"HTN\": \"hypertension clinic\",\n  \"HU\":  \"hospital unit\",\n  \"HUSB\":    \"husband\",\n  \"HUSCS\":   \"specimen collection site\",\n  \"ICU\": \"intensive care unit\",\n  \"IEC\": \"impairment evaluation center\",\n  \"INDIG\":   \"member of an indigenous people\",\n  \"INFD\":    \"infectious disease clinic\",\n  \"INJ\": \"injured plaintiff\",\n  \"INJWKR\":  \"injured worker\",\n  \"INLAB\":   \"inpatient laboratory\",\n  \"INPHARM\": \"inpatient pharmacy\",\n  \"INV\": \"infertility clinic\",\n  \"JURID\":   \"jurisdiction location identifier\",\n  \"L\":   \"pool\",\n  \"LABORATORY\":  \"laboratory\",\n  \"LOCHFID\": \"local location identifier\",\n  \"LY\":  \"layer\",\n  \"LYMPH\":   \"lympedema clinic\",\n  \"MAUNT\":   \"maternalaunt\",\n  \"MBL\": \"medical laboratory\",\n  \"MCOUSN\":  \"maternalcousin\",\n  \"MGDSF\":   \"manufactured drug strength form\",\n  \"MGEN\":    \"medical genetics clinic\",\n  \"MGGRFTH\": \"maternalgreatgrandfather\",\n  \"MGGRMTH\": \"maternalgreatgrandmother\",\n  \"MGGRPRN\": \"maternalgreatgrandparent\",\n  \"MGRFTH\":  \"maternalgrandfather\",\n  \"MGRMTH\":  \"maternalgrandmother\",\n  \"MGRPRN\":  \"maternalgrandparent\",\n  \"MHSP\":    \"military hospital\",\n  \"MIL\": \"military\",\n  \"MOBL\":    \"mobile unit\",\n  \"MT\":  \"meat\",\n  \"MTH\": \"mother\",\n  \"MTHINLAW\":    \"mother-in-law\",\n  \"MU\":  \"multiplier\",\n  \"MUNCLE\":  \"maternaluncle\",\n  \"NBOR\":    \"neighbor\",\n  \"NBRO\":    \"natural brother\",\n  \"NCCF\":    \"nursing or custodial care facility\",\n  \"NCCS\":    \"neurology critical care and stroke unit\",\n  \"NCHILD\":  \"natural child\",\n  \"NEPH\":    \"nephrology clinic\",\n  \"NEPHEW\":  \"nephew\",\n  \"NEUR\":    \"neurology clinic\",\n  \"NFTH\":    \"natural father\",\n  \"NFTHF\":   \"natural father of fetus\",\n  \"NIECE\":   \"niece\",\n  \"NIENEPH\": \"niece/nephew\",\n  \"NMTH\":    \"natural mother\",\n  \"NOK\": \"next of kin\",\n  \"NPRN\":    \"natural parent\",\n  \"NS\":  \"neurosurgery unit\",\n  \"NSIB\":    \"natural sibling\",\n  \"NSIS\":    \"natural sister\",\n  \"O\":   \"operator proficiency\",\n  \"OB\":  \"obstetrics clinic\",\n  \"OF\":  \"outpatient facility\",\n  \"OMS\": \"oral and maxillofacial surgery clinic\",\n  \"ONCL\":    \"medical oncology clinic\",\n  \"OPH\": \"opthalmology clinic\",\n  \"OPTC\":    \"optometry clinic\",\n  \"ORG\": \"organizational contact\",\n  \"ORTHO\":   \"orthopedics clinic\",\n  \"OUTLAB\":  \"outpatient laboratory\",\n  \"OUTPHARM\":    \"outpatient pharmacy\",\n  \"P\":   \"patient\",\n  \"PAINCL\":  \"pain clinic\",\n  \"PATHOLOGIST\": \"pathologist\",\n  \"PAUNT\":   \"paternalaunt\",\n  \"PAYOR\":   \"payor contact\",\n  \"PC\":  \"primary care clinic\",\n  \"PCOUSN\":  \"paternalcousin\",\n  \"PEDC\":    \"pediatrics clinic\",\n  \"PEDCARD\": \"pediatric cardiology clinic\",\n  \"PEDE\":    \"pediatric endocrinology clinic\",\n  \"PEDGI\":   \"pediatric gastroenterology clinic\",\n  \"PEDHEM\":  \"pediatric hematology clinic\",\n  \"PEDHO\":   \"pediatric oncology clinic\",\n  \"PEDICU\":  \"pediatric intensive care unit\",\n  \"PEDID\":   \"pediatric infectious disease clinic\",\n  \"PEDNEPH\": \"pediatric nephrology clinic\",\n  \"PEDNICU\": \"pediatric neonatal intensive care unit\",\n  \"PEDRHEUM\":    \"pediatric rheumatology clinic\",\n  \"PEDU\":    \"pediatric unit\",\n  \"PGGRFTH\": \"paternalgreatgrandfather\",\n  \"PGGRMTH\": \"paternalgreatgrandmother\",\n  \"PGGRPRN\": \"paternalgreatgrandparent\",\n  \"PGRFTH\":  \"paternalgrandfather\",\n  \"PGRMTH\":  \"paternalgrandmother\",\n  \"PGRPRN\":  \"paternalgrandparent\",\n  \"PH\":  \"policy holder\",\n  \"PHARM\":   \"pharmacy\",\n  \"PHLEBOTOMIST\":    \"phlebotomist\",\n  \"PHU\": \"psychiatric hospital unit\",\n  \"PL\":  \"pleasure\",\n  \"PLS\": \"plastic surgery clinic\",\n  \"POD\": \"podiatry clinic\",\n  \"POWATT\":  \"power of attorney\",\n  \"PRC\": \"pain rehabilitation center\",\n  \"PREV\":    \"preventive medicine clinic\",\n  \"PRN\": \"parent\",\n  \"PRNINLAW\":    \"parent in-law\",\n  \"PROCTO\":  \"proctology clinic\",\n  \"PROFF\":   \"provider's office\",\n  \"PROG\":    \"program eligible\",\n  \"PROS\":    \"prosthodontics clinic\",\n  \"PSI\": \"psychology clinic\",\n  \"PSTUD\":   \"part-time student\",\n  \"PSY\": \"psychiatry clinic\",\n  \"PSYCHF\":  \"psychiatric care facility\",\n  \"PT\":  \"patient\",\n  \"PTRES\":   \"patient's residence\",\n  \"PUNCLE\":  \"paternaluncle\",\n  \"Q\":   \"quality control\",\n  \"R\":   \"replicate\",\n  \"RADDX\":   \"radiology diagnostics or therapeutics unit\",\n  \"RADO\":    \"radiation oncology unit\",\n  \"RC\":  \"racing\",\n  \"RESPRSN\": \"responsible party\",\n  \"RETIREE\": \"retiree\",\n  \"RETMIL\":  \"retired military\",\n  \"RH\":  \"rehabilitation hospital\",\n  \"RHAT\":    \"addiction treatment center\",\n  \"RHEUM\":   \"rheumatology clinic\",\n  \"RHII\":    \"intellectual impairment center\",\n  \"RHMAD\":   \"parents with adjustment difficulties center\",\n  \"RHPI\":    \"physical impairment center\",\n  \"RHPIH\":   \"physical impairment - hearing center\",\n  \"RHPIMS\":  \"physical impairment - motor skills center\",\n  \"RHPIVS\":  \"physical impairment - visual skills center\",\n  \"RHU\": \"rehabilitation hospital unit\",\n  \"RHYAD\":   \"youths with adjustment difficulties center\",\n  \"RNEU\":    \"neuroradiology unit\",\n  \"ROOM\":    \"roommate\",\n  \"RTF\": \"residential treatment facility\",\n  \"SCHOOL\":  \"school\",\n  \"SCN\": \"screening\",\n  \"SEE\": \"seeing\",\n  \"SELF\":    \"self\",\n  \"SELFINS\": \"self insured coverage sponsor\",\n  \"SH\":  \"show\",\n  \"SIB\": \"sibling\",\n  \"SIBINLAW\":    \"sibling in-law\",\n  \"SIGOTHR\": \"significant other\",\n  \"SIS\": \"sister\",\n  \"SISINLAW\":    \"sister-in-law\",\n  \"SLEEP\":   \"sleep disorders unit\",\n  \"SNF\": \"skilled nursing facility\",\n  \"SNIFF\":   \"sniffing\",\n  \"SON\": \"natural son\",\n  \"SONADOPT\":    \"adopted son\",\n  \"SONC\":    \"son\",\n  \"SONFOST\": \"foster son\",\n  \"SONINLAW\":    \"son in-law\",\n  \"SPMED\":   \"sports medicine clinic\",\n  \"SPON\":    \"sponsored dependent\",\n  \"SPOWATT\": \"special power of attorney\",\n  \"SPS\": \"spouse\",\n  \"STPBRO\":  \"stepbrother\",\n  \"STPCHLD\": \"step child\",\n  \"STPDAU\":  \"stepdaughter\",\n  \"STPFTH\":  \"stepfather\",\n  \"STPMTH\":  \"stepmother\",\n  \"STPPRN\":  \"step parent\",\n  \"STPSIB\":  \"step sibling\",\n  \"STPSIS\":  \"stepsister\",\n  \"STPSON\":  \"stepson\",\n  \"STUD\":    \"student\",\n  \"SU\":  \"surgery clinic\",\n  \"SUBJECT\": \"self\",\n  \"SURF\":    \"substance use rehabilitation facility\",\n  \"THIRDPARTY\":  \"third party\",\n  \"TPA\": \"third party administrator\",\n  \"TR\":  \"transplant clinic\",\n  \"TRAVEL\":  \"travel and geographic medicine clinic\",\n  \"TRB\": \"tribal member\",\n  \"UMO\": \"utilization management organization\",\n  \"UNCLE\":   \"uncle\",\n  \"UPC\": \"underage protection center\",\n  \"URO\": \"urology clinic\",\n  \"V\":   \"verifying\",\n  \"VET\": \"veteran\",\n  \"VL\":  \"veal\",\n  \"WARD\":    \"ward\",\n  \"WIFE\":    \"wife\",\n  \"WL\":  \"wool\",\n  \"WND\": \"wound clinic\",\n  \"WO\":  \"working\",\n  \"WORK\":    \"work site\",\n};\n\nvar PROBLEM_STATUS_MAP = {\n  \"55561003\": \"active\",\n  \"73425007\": \"inactive\",\n  \"413322009\": \"resolved\"\n};\n\n\n// copied from _.invert to avoid making browser users include all of underscore\nvar invertKeys = function(obj) {\n  var result = {};\n  var keys = Object.keys(obj);\n  for (var i = 0, length = keys.length; i < length; i++) {\n    result[obj[keys[i]]] = keys[i];\n  }\n  return result;\n};\n\nvar lookupFnGenerator = function(map) {\n  return function(key) {\n    return map[key] || null;\n  };\n};\nvar reverseLookupFnGenerator = function(map) {\n  return function(key) {\n    if (!key) { return null; }\n    var invertedMap = invertKeys(map);\n    key = key.toLowerCase();\n    return invertedMap[key] || null;\n  };\n};\n\n\nmodule.exports =  {\n  gender: lookupFnGenerator(GENDER_MAP),\n  reverseGender: reverseLookupFnGenerator(GENDER_MAP),\n  maritalStatus: lookupFnGenerator(MARITAL_STATUS_MAP),\n  reverseMaritalStatus: reverseLookupFnGenerator(MARITAL_STATUS_MAP),\n  religion: lookupFnGenerator(RELIGION_MAP),\n  reverseReligion: reverseLookupFnGenerator(RELIGION_MAP),\n  raceEthnicity: lookupFnGenerator(RACE_ETHNICITY_MAP),\n  reverseRaceEthnicity: reverseLookupFnGenerator(RACE_ETHNICITY_MAP),\n  role: lookupFnGenerator(ROLE_MAP),\n  reverseRole: reverseLookupFnGenerator(ROLE_MAP),\n  problemStatus: lookupFnGenerator(PROBLEM_STATUS_MAP),\n  reverseProblemStatus: reverseLookupFnGenerator(PROBLEM_STATUS_MAP)\n};\n","/*\n * ...\n */\nvar { stripWhitespace } = require('./common');\n/*\n  * A function used to wrap DOM elements in an object so methods can be added\n  * to the element object. IE8 does not allow methods to be added directly to\n  * DOM objects.\n  */\nvar wrapElement = function (el) {\n  function wrapElementHelper(currentEl) {\n    return {\n      el: currentEl,\n      template: template,\n      content: content,\n      tag: tag,\n      immediateChildTag: immediateChildTag,\n      elsByTag: elsByTag,\n      attr: attr,\n      boolAttr: boolAttr,\n      val: val,\n      isEmpty: isEmpty\n    };\n  }\n\n  // el is an array of elements\n  if (el.length) {\n    var els = [];\n    for (var i = 0; i < el.length; i++) {\n      els.push(wrapElementHelper(el[i]));\n    }\n    return els;\n\n  // el is a single element\n  } else {\n    return wrapElementHelper(el);\n  }\n};\n\n\n/*\n  * Find element by tag name, then attribute value.\n  */\nvar tagAttrVal = function (el, tag, attr, value) {\n  el = el.getElementsByTagName(tag);\n  for (var i = 0; i < el.length; i++) {\n    if (el[i].getAttribute(attr) === value) {\n      return el[i];\n    }\n  }\n};\n\n\n/*\n  * Search for a template ID, and return its parent element.\n  * Example:\n  *   <templateId root=\"2.16.840.1.113883.10.20.22.2.17\"/>\n  * Can be found using:\n  *   el = dom.template('2.16.840.1.113883.10.20.22.2.17');\n  */\nvar template = function (templateId) {\n  var el = tagAttrVal(this.el, 'templateId', 'root', templateId);\n  if (!el) {\n    return emptyEl();\n  } else {\n    return wrapElement(el.parentNode);\n  }\n};\n\n/*\n  * Search for a content tag by \"ID\", and return it as an element.\n  * These are used in the unstructured versions of each section but\n  * referenced from the structured version sometimes.\n  * Example:\n  *   <content ID=\"UniqueNameReferencedElsewhere\"/>\n  * Can be found using:\n  *   el = dom.content('UniqueNameReferencedElsewhere');\n  *\n  * We can't use `getElementById` because `ID` (the standard attribute name\n  * in this context) is not the same attribute as `id` in XML, so there are no matches\n  */\nvar content = function (contentId) {\n    var el = tagAttrVal(this.el, 'content', 'ID', contentId);\n    if (!el) {\n      // check the <td> tag too, which isn't really correct but\n      // will inevitably be used sometimes because it looks like very\n      // normal HTML to put the data directly in a <td>\n      el = tagAttrVal(this.el, 'td', 'ID', contentId);\n    }\n    if (!el) {\n      // Ugh, Epic uses really non-standard locations.\n      el = tagAttrVal(this.el, 'caption', 'ID', contentId) ||\n            tagAttrVal(this.el, 'paragraph', 'ID', contentId) ||\n            tagAttrVal(this.el, 'tr', 'ID', contentId) ||\n            tagAttrVal(this.el, 'item', 'ID', contentId);\n    }\n\n    if (!el) {\n      return emptyEl();\n    } else {\n      return wrapElement(el);\n    }\n  };\n\n\n/*\n  * Search for the first occurrence of an element by tag name.\n  */\nvar tag = function (tag) {\n  var el = this.el.getElementsByTagName(tag)[0];\n  if (!el) {\n    return emptyEl();\n  } else {\n    return wrapElement(el);\n  }\n};\n\n/*\n  * Like `tag`, except it will only count a tag that is an immediate child of `this`.\n  * This is useful for tags like \"text\" which A. may not be present for a given location\n  * in every document and B. have a very different meaning depending on their positioning\n  *\n  *   <parent>\n  *     <target></target>\n  *   </parent>\n  * vs.\n  *   <parent>\n  *     <intermediate>\n  *       <target></target>\n  *     </intermediate>\n  *   </parent>\n  * parent.immediateChildTag('target') will have a result in the first case but not in the second.\n  */\nvar immediateChildTag = function (tag) {\n  var els = this.el.getElementsByTagName(tag);\n  if (!els) { return null; }\n  for (var i = 0; i < els.length; i++) {\n    if (els[i].parentNode === this.el) {\n      return wrapElement(els[i]);\n    }\n  }\n  return emptyEl();\n};\n\n\n/*\n  * Search for all elements by tag name.\n  */\nvar elsByTag = function (tag) {\n  return wrapElement(this.el.getElementsByTagName(tag));\n};\n\n\nvar unescapeSpecialChars = function(s) {\n  if (!s) { return s; }\n  return s.replace(/&lt;/g, '<')\n          .replace(/&gt;/g, '>')\n          .replace(/&amp;/g, '&')\n          .replace(/&quot;/g, '\"')\n          .replace(/&apos;/g, \"'\");\n};\n\n\n/*\n  * Retrieve the element's attribute value. Example:\n  *   value = el.attr('displayName');\n  *\n  * The browser and jsdom return \"null\" for empty attributes;\n  * xmldom (which we now use because it's faster / can be explicitly\n  * told to parse malformed XML as XML anyways), return the empty\n  * string instead, so we fix that here.\n  */\nvar attr = function (attrName) {\n  if (!this.el) { return null; }\n  var attrVal = this.el.getAttribute(attrName);\n  if (attrVal) {\n    return unescapeSpecialChars(attrVal);\n  }\n  return null;\n};\n\n/*\n  * Wrapper for attr() for retrieving boolean attributes;\n  * a raw call attr() will return Strings, which can be unexpected,\n  * since the string 'false' will by truthy\n  */\nvar boolAttr = function (attrName) {\n  var rawAttr = this.attr(attrName);\n  if (rawAttr === 'true' || rawAttr === '1') {\n    return true;\n  }\n  return false;\n};\n\n/*\n  * Retrieve the element's value. For example, if the element is:\n  *   <city>Madison</city>\n  * Use:\n  *   value = el.tag('city').val();\n  *\n  * This function also knows how to retrieve the value of <reference> tags,\n  * which can store their content in a <content> tag in a totally different\n  * part of the document.\n  */\nvar val = function (html) {\n  if (!this.el) { return null; }\n  if (!this.el.childNodes || !this.el.childNodes.length) { return null; }\n\n  var textContent;\n  if (html) {\n    textContent = this.el.innerHTML;\n    if (!textContent && root.XMLSerializer)\n      textContent = new XMLSerializer().serializeToString(this.el);\n  } else {\n    textContent = this.el.textContent;\n  }\n\n  // if there's no text value here and the only thing inside is a\n  // <reference> tag, see if there's a linked <content> tag we can\n  // get something out of\n  if (!stripWhitespace(textContent)) {\n\n    var contentId;\n    // \"no text value\" might mean there's just a reference tag\n    if (this.el.childNodes.length === 1 &&\n        this.el.childNodes[0].tagName === 'reference') {\n      contentId = this.el.childNodes[0].getAttribute('value');\n\n    // or maybe a newlines on top/above the reference tag\n    } else if (this.el.childNodes.length === 3 &&\n        this.el.childNodes[1].tagName === 'reference') {\n      contentId = this.el.childNodes[1].getAttribute('value');\n\n    } else {\n      return unescapeSpecialChars(textContent);\n    }\n\n    if (contentId && contentId[0] === '#') {\n      contentId = contentId.slice(1); // get rid of the '#'\n      var docRoot = wrapElement(this.el.ownerDocument);\n      var contentTag = docRoot.content(contentId);\n      return contentTag.val();\n    }\n  }\n\n  return unescapeSpecialChars(textContent);\n};\n\n\n/*\n  * Creates and returns an empty DOM element with tag name \"empty\":\n  *   <empty></empty>\n  */\nvar emptyEl = function () {\n  var el = doc.createElement('empty');\n  return wrapElement(el);\n};\n\n\n/*\n  * Determines if the element is empty, i.e.:\n  *   <empty></empty>\n  * This element is created by function `emptyEL`.\n  */\nvar isEmpty = function () {\n  if (this.el.tagName.toLowerCase() === 'empty') {\n    return true;\n  } else {\n    return false;\n  }\n};\n\n\n/*\n  * Cross-browser XML parsing supporting IE8+ and Node.js.\n  */\nfunction parse(data) {\n  // XML data must be a string\n  if (!data || typeof data !== \"string\") {\n    console.log(\"BB Error: XML data is not a string\");\n    return null;\n  }\n\n  var xml, parser;\n\n  // Node\n  if (isNode) {\n    parser = new (xmldom.DOMParser)();\n    xml = parser.parseFromString(data, \"text/xml\");\n\n  // Browser\n  } else {\n\n    // Standard parser\n    if (window.DOMParser) {\n      parser = new DOMParser();\n      xml = parser.parseFromString(data, \"text/xml\");\n\n    // IE\n    } else {\n      try {\n        xml = new ActiveXObject(\"Microsoft.XMLDOM\");\n        xml.async = \"false\";\n        xml.loadXML(data);\n      } catch (e) {\n        console.log(\"BB ActiveX Exception: Could not parse XML\");\n      }\n    }\n  }\n\n  if (!xml || !xml.documentElement || xml.getElementsByTagName(\"parsererror\").length) {\n    console.log(\"BB Error: Could not parse XML\");\n    return null;\n  }\n\n  return wrapElement(xml);\n};\n\n\n// Establish the root object, `window` in the browser, or `global` in Node.\nvar isBrowser = typeof window !== 'undefined'\n    && ({}).toString.call(window) === '[object Window]';\n\nvar isNode = typeof global !== \"undefined\"\n    && ({}).toString.call(global) === '[object global]';\n\nvar root = isBrowser ? window : global,\n    xmldom,\n    doc = root.document; // Will be `undefined` if we're in Node\n\n// Check if we're in Node. If so, pull in `xmldom` so we can simulate the DOM.\nif (isNode && !doc) {\n  xmldom = require(\"xmldom\");\n  doc = new xmldom.DOMImplementation().createDocument();\n}\n\nmodule.exports = {\n  parse: parse\n};\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","module.exports = require(\"xmldom\");","/*\n  * ...\n  */\nvar C32 = require('./documents/c32');\nvar CCD = require('./documents/ccd');\nvar CCDA = require('./documents/ccda');\nvar CCDAR2 = require('./documents/ccdar2');\n\nmodule.exports = function() {\n  var self = this;\n\n  self.detect = detect;\n  self.entries = entries;\n  self.parseDate = parseDate;\n  self.parseName = parseName;\n  self.parseAddress = parseAddress;\n  self.C32 = new C32(getEntries);\n  self.CCD = new CCD(getEntries);\n  self.CCDA = new CCDA(getEntries);\n  self.CCDAR2 = new CCDAR2(getEntries);\n};\n\nfunction getEntries() {\n  return entries;\n};\n\nfunction detect(data) {\n  if (!data.template) {\n    return 'json';\n  }\n  \n  if (!data.template('2.16.840.1.113883.3.88.11.32.1').isEmpty()) {\n    return 'c32';\n  } else if(!data.template('2.16.840.1.113883.10.20.22.1.1').isEmpty()) {\n    return 'ccda';\n  } else if(!data.template('2.16.840.1.113883.10.20.22.1.15').isEmpty()) {\n    return 'ccdar2';\n  }else if(!data.template('2.16.840.1.113883.10.20.22.1.2').isEmpty()) {\n    return 'ccd';\n  }\n};\n\n\n/*\n  * Get entries within an element (with tag name 'entry'), adds an `each` function\n  */\nfunction entries() {\n  var each = function (callback) {\n    for (var i = 0; i < this.length; i++) {\n      callback(this[i]);\n    }\n  };\n  \n  var els = this.elsByTag('entry');\n  els.each = each;\n  return els;\n};\n\n\n/*\n  * Parses an HL7 date in String form and creates a new Date object.\n  * \n  * TODO: CCDA dates can be in form:\n  *   <effectiveTime value=\"20130703094812\"/>\n  * ...or:\n  *   <effectiveTime>\n  *     <low value=\"19630617120000\"/>\n  *     <high value=\"20110207100000\"/>\n  *   </effectiveTime>\n  * For the latter, parseDate will not be given type `String`\n  * and will return `null`.\n  */\nfunction parseDate(str) {\n  if (!str || typeof str !== 'string') {\n    return null;\n  }\n\n  // Note: months start at 0 (so January is month 0)\n\n  // e.g., value=\"1999\" translates to Jan 1, 1999\n  if (str.length === 4) {\n    return new Date(str, 0, 1);\n  }\n\n  var year = str.substr(0, 4);\n  // subtract 1 from the month since they're zero-indexed\n  var month = parseInt(str.substr(4, 2), 10) - 1;\n  // days are not zero-indexed. If we end up with the day 0 or '',\n  // that will be equivalent to the last day of the previous month\n  var day = str.substr(6, 2) || 1;\n\n  // check for time info (the presence of at least hours and mins after the date)\n  if (str.length >= 12) {\n    var hour = str.substr(8, 2);\n    var min = str.substr(10, 2);\n    var secs = str.substr(12, 2);\n\n    // check for timezone info (the presence of chars after the seconds place)\n    if (str.length > 14) {\n      // _utcOffsetFromString will return 0 if there's no utc offset found.\n      var utcOffset = _utcOffsetFromString(str.substr(14));\n      // We subtract that offset from the local time to get back to UTC\n      // (e.g., if we're -480 mins behind UTC, we add 480 mins to get back to UTC)\n      min = _toInt(min) - utcOffset;\n    }\n\n    var date = new Date(Date.UTC(year, month, day, hour, min, secs));\n    // This flag lets us output datetime-precision in our JSON even if the time happens\n    // to translate to midnight local time. If we clone the date object, it is not\n    // guaranteed to survive.\n    date._parsedWithTimeData = true;\n    return date;\n  }\n\n  return new Date(year, month, day);\n};\n\n// These regexes and the two functions below are copied from moment.js\n// http://momentjs.com/\n// https://github.com/moment/moment/blob/develop/LICENSE\nvar parseTimezoneChunker = /([\\+\\-]|\\d\\d)/gi;\nvar parseTokenTimezone = /Z|[\\+\\-]\\d\\d:?\\d\\d/gi; // +00:00 -00:00 +0000 -0000 or Z\nfunction _utcOffsetFromString(string) {\n    string = string || '';\n    var possibleTzMatches = (string.match(parseTokenTimezone) || []),\n        tzChunk = possibleTzMatches[possibleTzMatches.length - 1] || [],\n        parts = (tzChunk + '').match(parseTimezoneChunker) || ['-', 0, 0],\n        minutes = +(parts[1] * 60) + _toInt(parts[2]);\n\n    return parts[0] === '+' ? minutes : -minutes;\n}\nfunction _toInt(argumentForCoercion) {\n    var coercedNumber = +argumentForCoercion,\n        value = 0;\n\n    if (coercedNumber !== 0 && isFinite(coercedNumber)) {\n        if (coercedNumber >= 0) {\n            value = Math.floor(coercedNumber);\n        } else {\n            value = Math.ceil(coercedNumber);\n        }\n    }\n\n    return value;\n}\n\n\n/*\n  * Parses an HL7 name (prefix / given [] / family)\n  */\nfunction parseName(nameEl) {\n  var prefix = nameEl.tag('prefix').val();\n  \n  var els = nameEl.elsByTag('given');\n  var given = [];\n  for (var i = 0; i < els.length; i++) {\n    var val = els[i].val();\n    if (val) { given.push(val); }\n  }\n  \n  var family = nameEl.tag('family').val();\n  \n  return {\n    prefix: prefix,\n    given: given,\n    family: family\n  };\n};\n\n\n/*\n  * Parses an HL7 address (streetAddressLine [], city, state, postalCode, country)\n  */\nfunction parseAddress(addrEl) {\n  var els = addrEl.elsByTag('streetAddressLine');\n  var street = [];\n  \n  for (var i = 0; i < els.length; i++) {\n    var val = els[i].val();\n    if (val) { street.push(val); }\n  }\n  \n  var city = addrEl.tag('city').val(),\n      state = addrEl.tag('state').val(),\n      zip = addrEl.tag('postalCode').val(),\n      country = addrEl.tag('country').val();\n  \n  return {\n    street: street,\n    city: city,\n    state: state,\n    zip: zip,\n    country: country\n  };\n};\n","/*\n * ...\n */\n \nmodule.exports = function(getEntries) {\n  var self = this;\n\n  self.getEntries = getEntries;\n  self.process = process;\n  self.section = section;\n\n  /*\n  * Preprocesses the C32 document\n  */\n  function process(c32) {\n    c32.section = section;\n    return c32;\n  };\n\n  /*\n    * Finds the section of a C32 document\n    *\n    * Usually we check first for the HITSP section ID and then for the HL7-CCD ID.\n    */\n  function section(name) {\n    var el, entries = self.getEntries();\n    \n    switch (name) {\n      case 'document':\n        return this.template('2.16.840.1.113883.3.88.11.32.1');\n      case 'allergies':\n        el = this.template('2.16.840.1.113883.3.88.11.83.102');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.1.2');\n        }\n        el.entries = entries;\n        return el;\n      case 'demographics':\n        return this.template('2.16.840.1.113883.3.88.11.32.1');\n      case 'encounters':\n        el = this.template('2.16.840.1.113883.3.88.11.83.127');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.1.3');\n        }\n        el.entries = entries;\n        return el;\n      case 'immunizations':\n        el = this.template('2.16.840.1.113883.3.88.11.83.117');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.1.6');\n        }\n        el.entries = entries;\n        return el;\n      case 'results':\n        el = this.template('2.16.840.1.113883.3.88.11.83.122');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.1.14');\n        }\n        el.entries = entries;\n        return el;\n      case 'medications':\n        el = this.template('2.16.840.1.113883.3.88.11.83.112');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.1.8');\n        }\n        el.entries = entries;\n        return el;\n      case 'problems':\n        el = this.template('2.16.840.1.113883.3.88.11.83.103');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.1.11');\n        }\n        el.entries = entries;\n        return el;\n      case 'procedures':\n        el = this.template('2.16.840.1.113883.3.88.11.83.108');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.1.12');\n        }\n        el.entries = entries;\n        return el;\n      case 'vitals':\n        el = this.template('2.16.840.1.113883.3.88.11.83.119');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.1.16');\n        }\n        el.entries = entries;\n        return el;\n    }\n    \n    return null;\n  };\n};\n","/*\n * ...\n */\n\nmodule.exports = function (getEntries) {\n    var self = this;\n    self.getEntries = getEntries;\n\n    self.process = process;\n    self.section = section;\n\n    /*\n     * Preprocesses the CCDAR2 document\n     */\n    function process(ccda) {\n        ccda.section = section;\n        return ccda;\n    };\n\n    /*\n     * Finds the section of a CCDA document\n     */\n    function section(name) {\n        var el, entries = self.getEntries();\n\n        switch (name) {\n            case 'document':\n                return this.template('2.16.840.1.113883.10.20.22.1.2');\n            case 'demographics':\n                return this.template('2.16.840.1.113883.10.20.22.1.2');\n            case 'health_concerns_document':\n                el = this.template('2.16.840.1.113883.10.20.22.2.58');\n                el.entries = entries;\n                return el;\n            case 'goals':\n                el = this.template('2.16.840.1.113883.10.20.22.2.60');\n                el.entries = entries;\n                return el;\n            case 'interventions':\n                el = this.template('2.16.840.1.113883.10.20.21.2.3');\n                el.entries = entries;\n                return el;\n            case 'health_status_outcomes':\n                el = this.template('2.16.840.1.113883.10.20.22.2.61');\n                el.entries = entries;\n                return el;\n        }\n\n        return null;\n    };\n}\n","/*\n * ...\n */\n\nmodule.exports = function (getEntries) {\n  var self = this;\n\n  self.getEntries = getEntries;\n  self.process = process;\n  self.section = section;\n  \n  /*\n   * Preprocesses the CCDA document\n   */\n  function process(ccda) {\n    ccda.section = section;\n    return ccda;\n  };  \n  \n  /*\n   * Finds the section of a CCDA document\n   */\n  function section(name) {\n    var el, entries = self.getEntries();\n    \n    switch (name) {\n      case 'document':\n        return this.template('2.16.840.1.113883.10.20.22.1.1');\n      case 'allergies':\n        el = this.template('2.16.840.1.113883.10.20.22.2.6.1');\n        el.entries = entries;\n        return el;\n      case 'care_plan':\n        el = this.template('2.16.840.1.113883.10.20.22.2.10');\n        el.entries = entries;\n        return el;\n      case 'chief_complaint':\n        el = this.template('2.16.840.1.113883.10.20.22.2.13');\n        if (el.isEmpty()) {\n          el = this.template('1.3.6.1.4.1.19376.1.5.3.1.1.13.2.1');\n        }\n        // no entries in Chief Complaint\n        return el;\n      case 'demographics':\n        return this.template('2.16.840.1.113883.10.20.22.1.1');\n      case 'encounters':\n        el = this.template('2.16.840.1.113883.10.20.22.2.22');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.22.2.22.1');\n        }\n        el.entries = entries;\n        return el;\n      case 'functional_statuses':\n        el = this.template('2.16.840.1.113883.10.20.22.2.14');\n        el.entries = entries;\n        return el;\n      case 'immunizations':\n        el = this.template('2.16.840.1.113883.10.20.22.2.2.1');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.22.2.2');\n        }\n        el.entries = entries;\n        return el;\n      case 'instructions':\n        el = this.template('2.16.840.1.113883.10.20.22.2.45');\n        el.entries = entries;\n        return el;\n      case 'results':\n        el = this.template('2.16.840.1.113883.10.20.22.2.3.1');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.22.2.3');\n        }\n        el.entries = entries;\n        return el;\n      case 'medications':\n        el = this.template('2.16.840.1.113883.10.20.22.2.1.1');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.22.2.1');\n        }\n        el.entries = entries;\n        return el;\n      case 'problems':\n        el = this.template('2.16.840.1.113883.10.20.22.2.5.1');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.22.2.5');\n        }\n        el.entries = entries;\n        return el;\n      case 'procedures':\n        el = this.template('2.16.840.1.113883.10.20.22.2.7.1');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.22.2.7');\n        }\n        el.entries = entries;\n        return el;\n      case 'social_history':\n        el = this.template('2.16.840.1.113883.10.20.22.2.17');\n        el.entries = entries;\n        return el;\n      case 'vitals':\n        el = this.template('2.16.840.1.113883.10.20.22.2.4.1');\n        if (el.isEmpty()) {\n          el = this.template('2.16.840.1.113883.10.20.22.2.4');\n        }\n        el.entries = entries;\n        return el;\n    }\n    \n    return null;\n  };  \n};\n","/*\n * ...\n */\n\nmodule.exports = function (getEntries) {\n    var self = this;\n    self.getEntries = getEntries;\n    \n    self.process = process;\n    self.section = section;   \n\n    /*\n     * Preprocesses the CCDAR2 document\n     */\n    function process(ccda) {\n        ccda.section = section;\n        return ccda;\n    };\n\n    /*\n     * Finds the section of a CCDA document\n     */\n    function section(name) {\n        var el, entries = self.getEntries();\n\n        switch (name) {\n            case 'document':\n                return this.template('2.16.840.1.113883.10.20.22.1.15');\n            case 'demographics':\n                return this.template('2.16.840.1.113883.10.20.22.1.15');\n            case 'health_concerns_document':\n                el = this.template('2.16.840.1.113883.10.20.22.2.58');\n                el.entries = entries;\n                return el;\n            case 'goals':\n                el = this.template('2.16.840.1.113883.10.20.22.2.60');\n                el.entries = entries;\n                return el;\n            case 'interventions':\n                el = this.template('2.16.840.1.113883.10.20.21.2.3');\n                el.entries = entries;\n                return el;\n            case 'health_status_outcomes':\n                el = this.template('2.16.840.1.113883.10.20.22.2.61');\n                el.entries = entries;\n                return el;\n        }\n\n        return null;\n    };\n}\n","/*\n * ...\n */\n\nvar C32 = require('./generators/c32');\nvar CCDA = require('./generators/ccda');\n\nvar method = function () {};\n\n/* exported Generators */\nmodule.exports = {\n  method: method,\n  C32: C32,\n  CCDA: CCDA\n};\n\n  /* Import ejs if we're in Node. Then setup custom formatting filters\n   */\n  if (typeof exports !== 'undefined') {\n    if (typeof module !== 'undefined' && module.exports) {\n      ejs = require(\"ejs\");\n    }\n  }\n\n  if (typeof ejs !== 'undefined') {\n    /* Filters are automatically available to ejs to be used like \"... | hl7Date\"\n     * Helpers are functions that we'll manually pass in to ejs.\n     * The intended distinction is that a helper gets called with regular function-call syntax\n     */\n    var pad = function(number) {\n      if (number < 10) {\n        return '0' + number;\n      }\n      return String(number);\n    };\n\n    if(!ejs.helpers){\n      ejs.helpers = {};\n    }\n\n    ejs.helpers.hl7Date = function(obj) {\n      try {\n          if (obj === null || obj === undefined) { return 'nullFlavor=\"UNK\"'; }\n          var date = new Date(obj);\n          if (isNaN(date.getTime())) { return obj; }\n\n          var dateStr = null;\n          if (date.getHours() || date.getMinutes() || date.getSeconds()) {\n            // If there's a meaningful time, output a UTC datetime\n            dateStr = date.getUTCFullYear() +\n              pad( date.getUTCMonth() + 1 ) +\n              pad( date.getUTCDate() );\n            var timeStr = pad( date.getUTCHours() ) +\n              pad( date.getUTCMinutes() ) +\n              pad ( date.getUTCSeconds() ) +\n              \"+0000\";\n            return 'value=\"' + dateStr + timeStr + '\"';\n\n          } else {\n            // If there's no time, don't apply timezone tranformations: just output a date\n            dateStr = String(date.getFullYear()) +\n              pad( date.getMonth() + 1 ) +\n              pad( date.getDate() );\n            return 'value=\"' + dateStr + '\"';\n          }\n\n      } catch (e) {\n          return obj;\n      }\n    };\n\n    var escapeSpecialChars = function(s) {\n      return s.replace(/</g, '&lt;')\n              .replace(/>/g, '&gt;')\n              .replace(/&/g, '&amp;')\n              .replace(/\"/g, '&quot;')\n              .replace(/'/g, '&apos;');\n    };\n\n    ejs.helpers.hl7Code = function(obj) {\n      if (!obj) { return ''; }\n\n      var tag = '';\n      var name = obj.name || '';\n      if (obj.name) { tag += 'displayName=\"'+escapeSpecialChars(name)+'\"'; }\n\n      if (obj.code) {\n        tag += ' code=\"'+obj.code+'\"';\n        if (obj.code_system) { tag += ' codeSystem=\"'+escapeSpecialChars(obj.code_system)+'\"'; }\n        if (obj.code_system_name) { tag += ' codeSystemName=\"' +\n                                        escapeSpecialChars(obj.code_system_name)+'\"'; }\n      } else {\n        tag += ' nullFlavor=\"UNK\"';\n      }\n\n      if (!obj.name && ! obj.code) {\n        return 'nullFlavor=\"UNK\"';\n      }\n\n      return tag;\n    };\n\n    ejs.helpers.emptyStringIfFalsy = function(obj) {\n      if (!obj) { return ''; }\n      return obj;\n    };\n\n    if (!ejs.helpers) ejs.helpers = {};\n    ejs.helpers.simpleTag = function(tagName, value) {\n      if (value) {\n        return \"<\"+tagName+\">\"+value+\"</\"+tagName+\">\";\n      } else {\n        return \"<\"+tagName+\" nullFlavor=\\\"UNK\\\" />\";\n      }\n    };\n\n    ejs.helpers.addressTags = function(addressDict) {\n      if (!addressDict) {\n        return '<streetAddressLine nullFlavor=\"NI\" />\\n' +\n                '<city nullFlavor=\"NI\" />\\n' +\n                '<state nullFlavor=\"NI\" />\\n' +\n                '<postalCode nullFlavor=\"NI\" />\\n' +\n                '<country nullFlavor=\"NI\" />\\n';\n      }\n\n      var tags = '';\n      if (!addressDict.street.length) {\n        tags += ejs.helpers.simpleTag('streetAddressLine', null) + '\\n';\n      } else {\n        for (var i=0; i<addressDict.street.length; i++) {\n          tags += ejs.helpers.simpleTag('streetAddressLine', addressDict.street[i]) + '\\n';\n        }\n      }\n      tags += ejs.helpers.simpleTag('city', addressDict.city) + '\\n';\n      tags += ejs.helpers.simpleTag('state', addressDict.state) + '\\n';\n      tags += ejs.helpers.simpleTag('postalCode', addressDict.zip) + '\\n';\n      tags += ejs.helpers.simpleTag('country', addressDict.country) + '\\n';\n      return tags;\n    };\n\n    ejs.helpers.nameTags = function(nameDict) {\n      if (!nameDict) {\n        return '<given nullFlavor=\"NI\" />\\n' +\n                '<family nullFlavor=\"NI\" />\\n';\n      }\n\n      var tags = '';\n      if (nameDict.prefix) {\n        tags += ejs.helpers.simpleTag('prefix', nameDict.prefix) + '\\n';\n      }\n      if (!nameDict.given.length) {\n        tags += ejs.helpers.simpleTag('given', null) + '\\n';\n      } else {\n        for (var i=0; i<nameDict.given.length; i++) {\n          tags += ejs.helpers.simpleTag('given', nameDict.given[i]) + '\\n';\n        }\n      }\n      tags += ejs.helpers.simpleTag('family', nameDict.family) + '\\n';\n      if (nameDict.suffix) {\n        tags += ejs.helpers.simpleTag('suffix', nameDict.suffix) + '\\n';\n      }\n      return tags;\n    };\n\n  }\n","/*\n * ...\n */\n\nmodule.exports = {\n  run: run\n};\n  \n/*\n  * Generates a C32 document\n  */\nfunction run(json, template, testingMode) {\n  /* jshint unused: false */ // only until this stub is actually implemented\n  console.log(\"C32 generation is not implemented yet\");\n  return null;\n};","/*\n * ...\n */\nvar _ = require('lodash');\nvar ejs = require('ejs');\nvar Core = require('../core');\n\nmodule.exports = {\n  run: run\n};\n\n/*\n  * Generates a CCDA document\n  * A lot of the EJS setup happens in generators.js\n  *\n  * If `testingMode` is true, we'll set the \"now\" variable to a specific,\n  * fixed time, so that the expected XML doesn't change across runs\n  */\nfunction run(json, template, testingMode) {\n  if (!template) {\n    console.log(\"Please provide a template EJS file for the Generator to use. \" +\n                \"Load it via fs.readFileSync in Node or XHR in the browser.\");\n    return null;\n  }\n\n  // `now` is actually now, unless we're running this for a test,\n  // in which case it's always Jan 1, 2000 at 12PM UTC\n  var now = (testingMode) ?\n    new Date('2000-01-01T12:00:00Z') : new Date();\n\n  var ccda = ejs.render(template, {\n    filename: 'ccda.xml',\n    bb: json,\n    now: now,\n    tagHelpers: ejs.helpers,\n    codes: Core.Codes\n  });\n  return ccda;\n};\n","module.exports = require(\"lodash\");","/*\n * ...\n */\nvar C32 = require('./parsers/c32');\nvar CCD = require('./parsers/ccd');\nvar CCDA = require('./parsers/ccda');\nvar CCDAR2 = require('./parsers/ccdar2');\n\nvar method = function () {};\n\n/* exported Parsers */\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.method = method;\n  self.C32 = new C32(self.doc);\n  self.CCD = new CCD(self.doc);\n  self.CCDA = new CCDA(self.doc);\n  self.CCDAR2 = new CCDAR2(self.doc);\n}; ","/*\n * Parser for the C32 document\n */\n\nvar Core = require('../core');\nvar AllergiesParser = require('./c32/allergies');\nvar DemographicsParser = require('./c32/demographics');\nvar DocumentParser = require('./c32/document');\nvar EncountersParser = require('./c32/encounters');\nvar ImmunizationsParser = require('./c32/immunizations');\nvar MedicationsParser = require('./c32/medications');\nvar ProblemsParser = require('./c32/problems');\nvar ProceduresParser = require('./c32/procedures');\nvar ResultsParser = require('./c32/results');\nvar VitalsParser = require('./c32/vitals');\nvar ParseGenericInfo = require('./generic');\n\nmodule.exports = function(doc) {\n  var self = this;\n\n  self.doc = doc;\n  self.allergiesParser = new AllergiesParser(self.doc);\n  self.demographicsParser = new DemographicsParser(self.doc);\n  self.demographicsParser = new DocumentParser(self.doc);\n  self.encountersParser = new EncountersParser(self.doc);\n  self.immunizationsParser = new ImmunizationsParser(self.doc);\n  self.medicationsParser = new MedicationsParser(self.doc);\n  self.problemsParser = new ProblemsParser(self.doc);\n  self.proceduresParser = new ProceduresParser(self.doc);\n  self.resultsParser = new ResultsParser(self.doc);\n  self.vitalsParser = new VitalsParser(self.doc);\n\n  self.run = function (c32) {\n    var data = {};\n\n    data.document              = self.demographicsParser.parse(c32);\n    data.allergies             = self.allergiesParser.parse(c32);\n    data.demographics          = self.demographicsParser.parse(c32);\n    data.encounters            = self.encountersParser.parse(c32);\n    var parsedImmunizations    = self.immunizationsParser.parse(c32);\n    data.immunizations         = parsedImmunizations.administered;\n    data.immunization_declines = parsedImmunizations.declined;\n    data.results               = self.resultsParser.parse(c32);\n    data.medications           = self.medicationsParser.parse(c32);\n    data.problems              = self.problemsParser.parse(c32);\n    data.procedures            = self.proceduresParser.parse(c32);\n    data.vitals                = self.vitalsParser.parse(c32);\n\n    data.json                       = Core.json;\n    data.document.json              = Core.json;\n    data.allergies.json             = Core.json;\n    data.demographics.json          = Core.json;\n    data.encounters.json            = Core.json;\n    data.immunizations.json         = Core.json;\n    data.immunization_declines.json = Core.json;\n    data.results.json               = Core.json;\n    data.medications.json           = Core.json;\n    data.problems.json              = Core.json;\n    data.procedures.json            = Core.json;\n    data.vitals.json                = Core.json;\n\n    // Sections that are in CCDA but not C32... we want to keep the API\n    // consistent, even if the entries are always null\n    data.smoking_status = {\n      date: null,\n      name: null,\n      code: null,\n      code_system: null,\n      code_system_name: null\n    };\n    data.smoking_status.json = Core.json;\n\n    data.chief_complaint = {\n      text: null\n    };\n    data.chief_complaint.json = Core.json;\n\n    data.care_plan = [];\n    data.care_plan.json = Core.json;\n\n    data.instructions = [];\n    data.instructions.json = Core.json;\n\n    data.functional_statuses = [];\n    data.functional_statuses.json = Core.json;\n\n    // Decorate each section with Title, templateId and text and adds missing sections\n    ParseGenericInfo(c32, data);\n\n    return data;\n  };\n};\n","/*\n * Parser for the C32 allergies section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.parse = parse;\n\n  function parse(c32) {\n  \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var allergies = c32.section('allergies');\n\n    var data = {}, el;\n    data.entries = [];\n    data.displayName = \"Allergies\";\n    data.templateId = allergies.tag('templateId').attr('root');\n    data.text = allergies.tag('text').val(true);\n\n    allergies.entries().each(function(entry) {\n      \n      el = entry.tag('effectiveTime');\n      var start_date = parseDate(el.tag('low').attr('value')),\n          end_date = parseDate(el.tag('high').attr('value'));\n      \n      el = entry.template('2.16.840.1.113883.3.88.11.83.6').tag('code');\n      var name = el.attr('displayName'),\n          code = el.attr('code'),\n          code_system = el.attr('codeSystem'),\n          code_system_name = el.attr('codeSystemName');\n      \n      // value => reaction_type\n      el = entry.template('2.16.840.1.113883.3.88.11.83.6').tag('value');\n      var reaction_type_name = el.attr('displayName'),\n          reaction_type_code = el.attr('code'),\n          reaction_type_code_system = el.attr('codeSystem'),\n          reaction_type_code_system_name = el.attr('codeSystemName');\n      \n      // reaction\n      el = entry.template('2.16.840.1.113883.10.20.1.54').tag('value');\n      var reaction_name = el.attr('displayName'),\n          reaction_code = el.attr('code'),\n          reaction_code_system = el.attr('codeSystem');\n      \n      // an irregularity seen in some c32s\n      if (!reaction_name) {\n        el = entry.template('2.16.840.1.113883.10.20.1.54').tag('text');\n        if (!el.isEmpty()) {\n          reaction_name = Core.stripWhitespace(el.val());\n        }\n      }\n\n      // severity\n      el = entry.template('2.16.840.1.113883.10.20.1.55').tag('value');\n      var severity = el.attr('displayName');\n      \n      // participant => allergen\n      el = entry.tag('participant').tag('code');\n      var allergen_name = el.attr('displayName'),\n          allergen_code = el.attr('code'),\n          allergen_code_system = el.attr('codeSystem'),\n          allergen_code_system_name = el.attr('codeSystemName');\n\n      // another irregularity seen in some c32s\n      if (!allergen_name) {\n        el = entry.tag('participant').tag('name');\n        if (!el.isEmpty()) {\n          allergen_name = el.val();\n        }\n      }\n      if (!allergen_name) {\n        el = entry.template('2.16.840.1.113883.3.88.11.83.6').tag('originalText');\n        if (!el.isEmpty()) {\n          allergen_name = Core.stripWhitespace(el.val());\n        }\n      }\n      \n      // status\n      el = entry.template('2.16.840.1.113883.10.20.1.39').tag('value');\n      var status = el.attr('displayName');\n      \n      data.entries.push({\n        date_range: {\n          start: start_date,\n          end: end_date\n        },\n        name: name,\n        code: code,\n        code_system: code_system,\n        code_system_name: code_system_name,\n        status: status,\n        severity: severity,\n        reaction: {\n          name: reaction_name,\n          code: reaction_code,\n          code_system: reaction_code_system\n        },\n        reaction_type: {\n          name: reaction_type_name,\n          code: reaction_type_code,\n          code_system: reaction_type_code_system,\n          code_system_name: reaction_type_code_system_name\n        },\n        allergen: {\n          name: allergen_name,\n          code: allergen_code,\n          code_system: allergen_code_system,\n          code_system_name: allergen_code_system_name\n        }\n      });\n    });  \n    return data;\n  }\n};\n","/*\n * Parser for the C32 demographics section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.parse = parse;\n\n  function parse(c32) {    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var data = {}, el;\n    \n    var demographics = c32.section('demographics');\n    \n    var patient = demographics.tag('patientRole');\n    el = patient.tag('patient').tag('name');\n    var patient_name_dict = parseName(el);\n    \n    el = patient.tag('patient');\n    var dob = parseDate(el.tag('birthTime').attr('value')),\n        gender = Core.Codes.gender(el.tag('administrativeGenderCode').attr('code')),\n        marital_status = Core.Codes.maritalStatus(el.tag('maritalStatusCode').attr('code'));\n    \n    el = patient.tag('addr');\n    var patient_address_dict = parseAddress(el);\n    \n    el = patient.tag('telecom');\n    var home = el.attr('value'),\n        work = null,\n        mobile = null;\n    \n    var email = null;\n    \n    var language = patient.tag('languageCommunication').tag('languageCode').attr('code'),\n        race = patient.tag('raceCode').attr('displayName'),\n        ethnicity = patient.tag('ethnicGroupCode').attr('displayName'),\n        religion = patient.tag('religiousAffiliationCode').attr('displayName');\n    \n    el = patient.tag('birthplace');\n    var birthplace_dict = parseAddress(el);\n    \n    el = patient.tag('guardian');\n    var guardian_relationship = el.tag('code').attr('displayName'),\n      guardian_relationship_code = el.tag('code').attr('code'),\n        guardian_home = el.tag('telecom').attr('value');\n    \n    el = el.tag('guardianPerson').tag('name');\n    var guardian_name_dict = parseName(el);\n    \n    el = patient.tag('guardian').tag('addr');\n    var guardian_address_dict = parseAddress(el);\n    \n    el = patient.tag('providerOrganization');\n    var provider_organization = el.tag('name').val(),\n        provider_phone = el.tag('telecom').attr('value'),\n        provider_address_dict = parseAddress(el.tag('addr'));\n    \n    data = {\n      name: patient_name_dict,\n      dob: dob,\n      gender: gender,\n      marital_status: marital_status,\n      address: patient_address_dict,\n      phone: {\n        home: home,\n        work: work,\n        mobile: mobile\n      },\n      email: email,\n      language: language,\n      race: race,\n      ethnicity: ethnicity,\n      religion: religion,\n      birthplace: {\n        state: birthplace_dict.state,\n        zip: birthplace_dict.zip,\n        country: birthplace_dict.country\n      },\n      guardian: {\n        name: {\n          given: guardian_name_dict.given,\n          family: guardian_name_dict.family\n        },\n        relationship: guardian_relationship,\n        relationship_code: guardian_relationship_code,\n        address: guardian_address_dict,\n        phone: {\n          home: guardian_home\n        }\n      },\n      provider: {\n        organization: provider_organization,\n        phone: provider_phone,\n        address: provider_address_dict\n      }\n    };\n    \n    return data;\n  };\n}\n","/*\n * Parser for the C32 document section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.parse = parse;\n\n  function parse(c32) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var data = {}, el;\n    \n    var doc = c32.section('document');\n  \n    // Parse Doc Type Info\n    var templates =  doc.elsByTag('templateId');\n    var rootTemplate = templates[0].attr('root');\n    var secondTemplate;\n    if(templates.length >1)\n      secondTemplate = templates[1].attr('root');\n    else\n      secondTemplate = rootTemplate;\n  \n    var loinc = doc.tag('code').attr('code');\n    var templateId = doc.tag('templateId').attr('root');\n    var displayName = doc.tag('code').attr('displayName');\n  \n    var nonXml = doc.tag('nonXMLBody');\n    var nonXmlNodes = nonXml.el.childNodes;\n  \n    var bodyType = \"structured\";\n    var nonXmlBody = {\n      type: \"\",\n      mediaType: \"\",\n      representation: \"\",\n      rawText: \"\",\n      reference: \"\"\n    };\n  \n    if(nonXmlNodes && nonXmlNodes.length > 0) {\n      bodyType = \"unstructured\";\n      var text = nonXml.tag('text');\n      var mediaType = \"\";\n      var representation = \"\";\n      var rawText = \"\";\n      var reference = \"\";\n      var type = \"\";\n  \n      // We have an embedded doc\n      if(text && text.attr('mediaType')) {\n        mediaType = text.attr('mediaType');\n        representation = text.attr('representation');\n        rawText = text.val();\n        type = \"embedded\";\n      }\n  \n      if(text && !mediaType) {\n        reference = text.tag('reference').attr('value');\n        type = \"reference\";\n      }\n      nonXmlBody = {\n        type: type,\n        mediaType: mediaType,\n        representation: representation,\n        rawText: rawText,\n        reference: reference\n      }\n    }\n  \n    var docType = {\n      type: \"CCDAR2\",\n      rootTemplateId: rootTemplate,\n      templateId: secondTemplate,\n      displayName: displayName,\n      loinc: loinc,\n      bodyType: bodyType,\n      nonXmlBody: nonXmlBody\n    };\n    \n    var date = parseDate(doc.tag('effectiveTime').attr('value'));\n    var title = Core.stripWhitespace(doc.tag('title').val());\n    \n    var author = doc.tag('author');\n    el = author.tag('assignedPerson').tag('name');\n    var name_dict = parseName(el);\n    // Sometimes C32s include names that are just like <name>String</name>\n    // and we still want to get something out in that case\n    if (!name_dict.prefix && !name_dict.given.length && !name_dict.family) {\n     name_dict.family = el.val();\n    }\n    \n    el = author.tag('addr');\n    var address_dict = parseAddress(el);\n    \n    el = author.tag('telecom');\n    var work_phone = el.attr('value');\n  \n    var documentation_of_list = [];\n    var performers = doc.tag('documentationOf').elsByTag('performer');\n    for (var i = 0; i < performers.length; i++) {\n      el = performers[i].tag('assignedPerson').tag('name');\n      var performer_name_dict = parseName(el);\n      var performer_phone = performers[i].tag('telecom').attr('value');\n      var performer_addr = parseAddress(el.tag('addr'));\n      documentation_of_list.push({\n        name: performer_name_dict,\n        phone: {\n          work: performer_phone\n        },\n        address: performer_addr\n      });\n    }\n  \n    el = doc.tag('encompassingEncounter');\n    var location_name = Core.stripWhitespace(el.tag('name').val());\n    var location_addr_dict = parseAddress(el.tag('addr'));\n    \n    var encounter_date = null;\n    el = el.tag('effectiveTime');\n    if (!el.isEmpty()) {\n      encounter_date = parseDate(el.attr('value'));\n    }\n    \n    data = {\n      type: docType,\n      date: date,\n      title: title,\n      author: {\n        name: name_dict,\n        address: address_dict,\n        phone: {\n          work: work_phone\n        }\n      },\n      documentation_of: documentation_of_list,\n      location: {\n        name: location_name,\n        address: location_addr_dict,\n        encounter_date: encounter_date\n      }\n    };\n    \n    return data;\n  };\n}","/*\n * Parser for the C32 encounters section\n */\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.parse = parse;\n\n  function parse(c32) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var encounters = c32.section('encounters');\n  \n    var data = {}, el;\n    data.entries = [];\n    data.displayName = \"Encounters\";\n    data.templateId = encounters.tag('templateId').attr('root');\n    data.text = encounters.tag('text').val(true);\n  \n    encounters.entries().each(function(entry) {\n      \n      var date = parseDate(entry.tag('effectiveTime').attr('value'));\n      if (!date) {\n        date = parseDate(entry.tag('effectiveTime').tag('low').attr('value'));\n      }\n      \n      el = entry.tag('code');\n      var name = el.attr('displayName'),\n          code = el.attr('code'),\n          code_system = el.attr('codeSystem'),\n          code_system_name = el.attr('codeSystemName'),\n          code_system_version = el.attr('codeSystemVersion');\n      \n      // translation\n      el = entry.tag('translation');\n      var translation_name = el.attr('displayName'),\n          translation_code = el.attr('code'),\n          translation_code_system = el.attr('codeSystem'),\n          translation_code_system_name = el.attr('codeSystemName');\n      \n      // performer\n      el = entry.tag('performer');\n      var performer_name = el.tag('name').val(),\n          performer_code = el.attr('code'),\n          performer_code_system = el.attr('codeSystem'),\n          performer_code_system_name = el.attr('codeSystemName');\n      \n      // participant => location\n      el = entry.tag('participant');\n      var organization = el.tag('name').val(),\n          location_dict = parseAddress(el);\n      location_dict.organization = organization;\n  \n      // findings\n      var findings = [];\n      var findingEls = entry.elsByTag('entryRelationship');\n      for (var i = 0; i < findingEls.length; i++) {\n        el = findingEls[i].tag('value');\n        findings.push({\n          name: el.attr('displayName'),\n          code: el.attr('code'),\n          code_system: el.attr('codeSystem')\n        });\n      }\n      \n      data.entries.push({\n        date: date,\n        name: name,\n        code: code,\n        code_system: code_system,\n        code_system_name: code_system_name,\n        code_system_version: code_system_version,\n        findings: findings,\n        translation: {\n          name: translation_name,\n          code: translation_code,\n          code_system: translation_code_system,\n          code_system_name: translation_code_system_name\n        },\n        performer: {\n          name: performer_name,\n          code: performer_code,\n          code_system: performer_code_system,\n          code_system_name: performer_code_system_name\n        },\n        location: location_dict\n      });\n    });\n    \n    return data;\n  };\n}\n","/*\n * Parser for the C32 immunizations section\n */\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.parse = parse;\n\n  function parse(c32) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var administeredData = {}, declinedData = {}, product, el;\n  \n    var immunizations = c32.section('immunizations');\n  \n    administeredData.entries = [];\n    administeredData.displayName = \"Immunizations\";\n    administeredData.templateId = immunizations.tag('templateId').attr('root');\n    administeredData.text = immunizations.tag('text').val(true);\n  \n    declinedData.entries = [];\n    declinedData.displayName = \"Immunizations Declined\";\n    declinedData.templateId = immunizations.tag('templateId').attr('root');\n    declinedData.text = immunizations.tag('text').val(true);\n  \n  \n    \n    immunizations.entries().each(function(entry) {\n      \n      // date\n      el = entry.tag('effectiveTime');\n      var date = parseDate(el.attr('value'));\n      if (!date) {\n        date = parseDate(el.tag('low').attr('value'));\n      }\n  \n      // if 'declined' is true, this is a record that this vaccine WASN'T administered\n      el = entry.tag('substanceAdministration');\n      var declined = el.boolAttr('negationInd');\n  \n      // product\n      product = entry.template('2.16.840.1.113883.10.20.1.53');\n      el = product.tag('code');\n      var product_name = el.attr('displayName'),\n          product_code = el.attr('code'),\n          product_code_system = el.attr('codeSystem'),\n          product_code_system_name = el.attr('codeSystemName');\n  \n      // translation\n      el = product.tag('translation');\n      var translation_name = el.attr('displayName'),\n          translation_code = el.attr('code'),\n          translation_code_system = el.attr('codeSystem'),\n          translation_code_system_name = el.attr('codeSystemName');\n  \n      // misc product details\n      el = product.tag('lotNumberText');\n      var lot_number = el.val();\n  \n      el = product.tag('manufacturerOrganization');\n      var manufacturer_name = el.tag('name').val();\n      \n      // route\n      el = entry.tag('routeCode');\n      var route_name = el.attr('displayName'),\n          route_code = el.attr('code'),\n          route_code_system = el.attr('codeSystem'),\n          route_code_system_name = el.attr('codeSystemName');\n      \n      // instructions\n      el = entry.template('2.16.840.1.113883.10.20.1.49');\n      var instructions_text = Core.stripWhitespace(el.tag('text').val());\n      el = el.tag('code');\n      var education_name = el.attr('displayName'),\n          education_code = el.attr('code'),\n          education_code_system = el.attr('codeSystem');\n  \n      // dose\n      el = entry.tag('doseQuantity');\n      var dose_value = el.attr('value'),\n          dose_unit = el.attr('unit');\n      \n      var data = (declined) ? declinedData : administeredData;\n      data.entries.push({\n        date: date,\n        product: {\n          name: product_name,\n          code: product_code,\n          code_system: product_code_system,\n          code_system_name: product_code_system_name,\n          translation: {\n            name: translation_name,\n            code: translation_code,\n            code_system: translation_code_system,\n            code_system_name: translation_code_system_name\n          },\n          lot_number: lot_number,\n          manufacturer_name: manufacturer_name\n        },\n        dose_quantity: {\n          value: dose_value,\n          unit: dose_unit\n        },\n        route: {\n          name: route_name,\n          code: route_code,\n          code_system: route_code_system,\n          code_system_name: route_code_system_name\n        },\n        instructions: instructions_text,\n        education_type: {\n          name: education_name,\n          code: education_code,\n          code_system: education_code_system\n        }\n      });\n    });\n    \n    return {\n      administered: administeredData,\n      declined: declinedData\n    };\n  };\n}\n","var Core = require('../../core');\n\n/*\n * Parser for the C32 medications section\n */\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.parse = parse;\n  \n  function parse(c32) {    \n    var parseDate = self.doc.parseDate;\n    var medications = c32.section('medications');\n  \n    var data = {}, el;\n    data.entries = [];\n    data.displayName = \"Medications\";\n    data.templateId = medications.tag('templateId').attr('root');\n    data.text = medications.tag('text').val(true);\n    \n    medications.entries().each(function(entry) {\n  \n      var text = null;\n      el = entry.tag('substanceAdministration').immediateChildTag('text');\n      if (!el.isEmpty()) {\n        // technically C32s don't use this, but C83s (another CCD) do,\n        // and CCDAs do, so we may see it anyways\n        text = Core.stripWhitespace(el.val());\n      }\n  \n      var effectiveTimes = entry.elsByTag('effectiveTime');\n  \n      el = effectiveTimes[0]; // the first effectiveTime is the med start date\n      var start_date = null, end_date = null;\n      if (el) {\n        start_date = parseDate(el.tag('low').attr('value'));\n        end_date = parseDate(el.tag('high').attr('value'));\n      }\n  \n      // the second effectiveTime might the schedule period or it might just\n      // be a random effectiveTime from further in the entry... xsi:type should tell us\n      el = effectiveTimes[1];\n      var schedule_type = null, schedule_period_value = null, schedule_period_unit = null;\n      if (el && el.attr('xsi:type') === 'PIVL_TS') {\n        var institutionSpecified = el.attr('institutionSpecified');\n        if (institutionSpecified === 'true') {\n          schedule_type= 'frequency';\n        } else if (institutionSpecified === 'false') {\n          schedule_type = 'interval';\n        }\n  \n        el = el.tag('period');\n        schedule_period_value = el.attr('value');\n        schedule_period_unit = el.attr('unit');\n      }\n      \n      el = entry.tag('manufacturedProduct').tag('code');\n      var product_name = el.attr('displayName'),\n          product_code = el.attr('code'),\n          product_code_system = el.attr('codeSystem');\n  \n      var product_original_text = null;\n      el = entry.tag('manufacturedProduct').tag('originalText');\n      if (!el.isEmpty()) {\n        product_original_text = Core.stripWhitespace(el.val());\n      }\n      // if we don't have a product name yet, try the originalText version\n      if (!product_name && product_original_text) {\n        product_name = product_original_text;\n      }\n  \n      // irregularity in some c32s\n      if (!product_name) {\n        el = entry.tag('manufacturedProduct').tag('name');\n        if (!el.isEmpty()) {\n          product_name = Core.stripWhitespace(el.val());\n        }\n      }\n      \n      el = entry.tag('manufacturedProduct').tag('translation');\n      var translation_name = el.attr('displayName'),\n          translation_code = el.attr('code'),\n          translation_code_system = el.attr('codeSystem'),\n          translation_code_system_name = el.attr('codeSystemName');\n      \n      el = entry.tag('doseQuantity');\n      var dose_value = el.attr('value'),\n          dose_unit = el.attr('unit');\n      \n      el = entry.tag('rateQuantity');\n      var rate_quantity_value = el.attr('value'),\n          rate_quantity_unit = el.attr('unit');\n      \n      el = entry.tag('precondition').tag('value');\n      var precondition_name = el.attr('displayName'),\n          precondition_code = el.attr('code'),\n          precondition_code_system = el.attr('codeSystem');\n      \n      el = entry.template('2.16.840.1.113883.10.20.1.28').tag('value');\n      var reason_name = el.attr('displayName'),\n          reason_code = el.attr('code'),\n          reason_code_system = el.attr('codeSystem');\n      \n      el = entry.tag('routeCode');\n      var route_name = el.attr('displayName'),\n          route_code = el.attr('code'),\n          route_code_system = el.attr('codeSystem'),\n          route_code_system_name = el.attr('codeSystemName');\n      \n      // participant/playingEntity => vehicle\n      el = entry.tag('participant').tag('playingEntity');\n      var vehicle_name = el.tag('name').val();\n  \n      el = el.tag('code');\n      // prefer the code vehicle_name but fall back to the non-coded one\n      // (which for C32s is in fact the primary field for this info)\n      vehicle_name = el.attr('displayName') || vehicle_name;\n      var vehicle_code = el.attr('code'),\n          vehicle_code_system = el.attr('codeSystem'),\n          vehicle_code_system_name = el.attr('codeSystemName');\n      \n      el = entry.tag('administrationUnitCode');\n      var administration_name = el.attr('displayName'),\n          administration_code = el.attr('code'),\n          administration_code_system = el.attr('codeSystem'),\n          administration_code_system_name = el.attr('codeSystemName');\n      \n      // performer => prescriber\n      el = entry.tag('performer');\n      var prescriber_organization = el.tag('name').val(),\n          prescriber_person = null;\n      \n      data.entries.push({\n        date_range: {\n          start: start_date,\n          end: end_date\n        },\n        text: text,\n        product: {\n          name: product_name,\n          text: product_original_text,\n          code: product_code,\n          code_system: product_code_system,\n          translation: {\n            name: translation_name,\n            code: translation_code,\n            code_system: translation_code_system,\n            code_system_name: translation_code_system_name\n          }\n        },\n        dose_quantity: {\n          value: dose_value,\n          unit: dose_unit\n        },\n        rate_quantity: {\n          value: rate_quantity_value,\n          unit: rate_quantity_unit\n        },\n        precondition: {\n          name: precondition_name,\n          code: precondition_code,\n          code_system: precondition_code_system\n        },\n        reason: {\n          name: reason_name,\n          code: reason_code,\n          code_system: reason_code_system\n        },\n        route: {\n          name: route_name,\n          code: route_code,\n          code_system: route_code_system,\n          code_system_name: route_code_system_name\n        },\n        schedule: {\n          type: schedule_type,\n          period_value: schedule_period_value,\n          period_unit: schedule_period_unit\n        },\n        vehicle: {\n          name: vehicle_name,\n          code: vehicle_code,\n          code_system: vehicle_code_system,\n          code_system_name: vehicle_code_system_name\n        },\n        administration: {\n          name: administration_name,\n          code: administration_code,\n          code_system: administration_code_system,\n          code_system_name: administration_code_system_name\n        },\n        prescriber: {\n          organization: prescriber_organization,\n          person: prescriber_person\n        }\n      });\n    });\n    \n    return data;\n  };\n}\n","var Core = require('../../core');\n\n/*\n * Parser for the C32 problems section\n */\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.parse = parse;\n\n  function parse(c32) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var problems = c32.section('problems');\n  \n    var data = {}, el;\n    data.entries = [];\n    data.displayName = \"Problems\";\n    data.templateId = problems.tag('templateId').attr('root');\n    data.text = problems.tag('text').val(true);\n  \n    problems.entries().each(function(entry) {\n      \n      el = entry.tag('effectiveTime');\n      var start_date = parseDate(el.tag('low').attr('value')),\n          end_date = parseDate(el.tag('high').attr('value'));\n      \n      el = entry.template('2.16.840.1.113883.10.20.1.28').tag('value');\n      var name = el.attr('displayName'),\n          code = el.attr('code'),\n          code_system = el.attr('codeSystem'),\n          code_system_name = el.attr('codeSystemName');\n  \n      // Pre-C32 CCDs put the problem name in this \"originalText\" field, and some vendors\n      // continue doing this with their C32, even though it's not technically correct\n      if (!name) {\n        el = entry.template('2.16.840.1.113883.10.20.1.28').tag('originalText');\n        if (!el.isEmpty()) {\n          name = Core.stripWhitespace(el.val());\n        }\n      }\n  \n      el = entry.template('2.16.840.1.113883.10.20.1.28').tag('translation');\n      var translation_name = el.attr('displayName'),\n          translation_code = el.attr('code'),\n          translation_code_system = el.attr('codeSystem'),\n          translation_code_system_name = el.attr('codeSystemName');\n      \n      el = entry.template('2.16.840.1.113883.10.20.1.50');\n      var status = el.tag('value').attr('displayName');\n      \n      var age = null;\n      el = entry.template('2.16.840.1.113883.10.20.1.38');\n      if (!el.isEmpty()) {\n        age = parseFloat(el.tag('value').attr('value'));\n      }\n      \n      data.entries.push({\n        date_range: {\n          start: start_date,\n          end: end_date\n        },\n        name: name,\n        status: status,\n        age: age,\n        code: code,\n        code_system: code_system,\n        code_system_name: code_system_name,\n        translation: {\n          name: translation_name,\n          code: translation_code,\n          code_system: translation_code_system,\n          code_system_name: translation_code_system_name\n        },\n        comment: null // not part of C32\n      });\n    });\n    \n    return data;\n  };\n}\n","/*\n * Parser for the C32 procedures section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.parse = parse;\n\n  function parse(c32) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var procedures = c32.section('procedures');\n  \n    var data = {}, el;\n    data.entries = [];\n    data.displayName = \"Procedures\";\n    data.templateId = procedures.tag('templateId').attr('root');\n    data.text = procedures.tag('text').val(true);\n    \n    procedures.entries().each(function(entry) {\n      \n      el = entry.tag('effectiveTime');\n      var date = parseDate(el.attr('value'));\n      \n      el = entry.tag('code');\n      var name = el.attr('displayName'),\n          code = el.attr('code'),\n          code_system = el.attr('codeSystem');\n  \n      if (!name) {\n        name = Core.stripWhitespace(entry.tag('originalText').val());\n      }\n      \n      // 'specimen' tag not always present\n      el = entry.tag('specimen').tag('code');\n      var specimen_name = el.attr('displayName'),\n          specimen_code = el.attr('code'),\n          specimen_code_system = el.attr('codeSystem');\n      \n      el = entry.tag('performer').tag('addr');\n      var organization = el.tag('name').val(),\n          phone = el.tag('telecom').attr('value');\n      \n      var performer_dict = parseAddress(el);\n      performer_dict.organization = organization;\n      performer_dict.phone = phone;\n      \n      // participant => device\n      el = entry.tag('participant').tag('code');\n      var device_name = el.attr('displayName'),\n          device_code = el.attr('code'),\n          device_code_system = el.attr('codeSystem');\n      \n      data.entries.push({\n        date: date,\n        name: name,\n        code: code,\n        code_system: code_system,\n        specimen: {\n          name: specimen_name,\n          code: specimen_code,\n          code_system: specimen_code_system\n        },\n        performer: performer_dict,\n        device: {\n          name: device_name,\n          code: device_code,\n          code_system: device_code_system\n        }\n      });\n    });\n    \n    return data;\n  };\n}","/*\n * Parser for the C32 results (labs) section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.parse = parse;\n\n  function parse(c32) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var results = c32.section('results');\n  \n    var data = {}, el;\n    data.entries = [];\n    data.displayName = \"Results\";\n    data.templateId = results.tag('templateId').attr('root');\n    data.text = results.tag('text').val(true);\n  \n  \n    results.entries().each(function(entry) {\n      \n      el = entry.tag('effectiveTime');\n      var panel_date = parseDate(entry.tag('effectiveTime').attr('value'));\n      if (!panel_date) {\n        panel_date = parseDate(entry.tag('effectiveTime').tag('low').attr('value'));\n      }\n      \n      // panel\n      el = entry.tag('code');\n      var panel_name = el.attr('displayName'),\n          panel_code = el.attr('code'),\n          panel_code_system = el.attr('codeSystem'),\n          panel_code_system_name = el.attr('codeSystemName');\n      \n      var observation;\n      var tests = entry.elsByTag('observation');\n      var tests_data = [];\n      \n      for (var i = 0; i < tests.length; i++) {\n        observation = tests[i];\n        \n        // sometimes results organizers contain non-results. we only want tests\n        if (observation.template('2.16.840.1.113883.10.20.1.31').val()) {\n          var date = parseDate(observation.tag('effectiveTime').attr('value'));\n          \n          el = observation.tag('code');\n          var name = el.attr('displayName'),\n              code = el.attr('code'),\n              code_system = el.attr('codeSystem'),\n              code_system_name = el.attr('codeSystemName');\n  \n          if (!name) {\n            name = Core.stripWhitespace(observation.tag('text').val());\n          }\n      \n          el = observation.tag('translation');\n          var translation_name = el.attr('displayName'),\n          translation_code = el.attr('code'),\n          translation_code_system = el.attr('codeSystem'),\n          translation_code_system_name = el.attr('codeSystemName');\n      \n          el = observation.tag('value');\n          var value = el.attr('value'),\n              unit = el.attr('unit');\n          // We could look for xsi:type=\"PQ\" (physical quantity) but it seems better\n          // not to trust that that field has been used correctly...\n          if (value && !isNaN(parseFloat(value))) {\n            value = parseFloat(value);\n          }\n          if (!value) {\n            value = el.val(); // look for free-text values\n          }\n      \n          el = observation.tag('referenceRange');\n          var reference_range_text = Core.stripWhitespace(el.tag('observationRange').tag('text').val()),\n              reference_range_low_unit = el.tag('observationRange').tag('low').attr('unit'),\n              reference_range_low_value = el.tag('observationRange').tag('low').attr('value'),\n              reference_range_high_unit = el.tag('observationRange').tag('high').attr('unit'),\n              reference_range_high_value = el.tag('observationRange').tag('high').attr('value');\n          \n          tests_data.push({\n            date: date,\n            name: name,\n            value: value,\n            unit: unit,\n            code: code,\n            code_system: code_system,\n            code_system_name: code_system_name,\n            translation: {\n              name: translation_name,\n              code: translation_code,\n              code_system: translation_code_system,\n              code_system_name: translation_code_system_name\n            },\n            reference_range: {\n              text: reference_range_text,\n              low_unit: reference_range_low_unit,\n              low_value: reference_range_low_value,\n              high_unit: reference_range_high_unit,\n              high_value: reference_range_high_value,\n            }\n          });\n        }\n      }\n      \n      data.entries.push({\n        name: panel_name,\n        code: panel_code,\n        code_system: panel_code_system,\n        code_system_name: panel_code_system_name,\n        date: panel_date,\n        tests: tests_data\n      });\n    });\n    \n    return data;\n  };  \n}","/*\n * Parser for the C32 vitals section\n */\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.parse = parse;\n\n  function parse(c32) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var vitals = c32.section('vitals');\n  \n    var data = {}, el;\n    data.entries = [];\n    data.displayName = \"Vitals\";\n    data.templateId = vitals.tag('templateId').attr('root');\n    data.text = vitals.tag('text').val(true);\n    \n    vitals.entries().each(function(entry) {\n      \n      el = entry.tag('effectiveTime');\n      var entry_date = parseDate(el.attr('value'));\n      \n      var result;\n      var results = entry.elsByTag('component');\n      var results_data = [];\n      \n      for (var j = 0; j < results.length; j++) {\n        result = results[j];\n        \n        // Results\n        \n        el = result.tag('code');\n        var name = el.attr('displayName'),\n            code = el.attr('code'),\n            code_system = el.attr('codeSystem'),\n            code_system_name = el.attr('codeSystemName');\n        \n        el = result.tag('value');\n        var value = parseFloat(el.attr('value')),\n            unit = el.attr('unit');\n        \n        results_data.push({\n          name: name,\n          code: code,\n          code_system: code_system,\n          code_system_name: code_system_name,\n          value: value,\n          unit: unit\n        });\n      }\n      \n      data.entries.push({\n        date: entry_date,\n        results: results_data\n      });\n    });\n    \n    return data;\n  };\n}","/*\n * Parser for the CCDAR2 document\n */\n\nvar ParseGenericInfo = require('./generic');\nvar Core = require('../core');\nvar DocumentParser = require('./ccd/document');\nvar DemographicsParser = require('./ccda/demographics');\nvar HealthConcernsParser = require('./ccdar2/health_concerns');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.documentParser = new DocumentParser(self.doc);\n  self.demographicsParser = new DemographicsParser(self.doc);\n  self.healthConcernsParser = new HealthConcernsParser(self.doc);\n  \n  self.run = function (ccda) {\n    var data = {};\n\n    data.document              = self.documentParser.document(ccda);\n    data.demographics          = self.demographicsParser.demographics(ccda);\n    data.health_concerns_document  = self.healthConcernsParser.health_concerns_document(ccda);\n    data.json                  = Core.json;\n\n    // Decorate each section with Title, templateId and text and adds missing sections\n    ParseGenericInfo(ccda, data);\n\n    return data;\n  };\n}\n","/*\n * Parser for the CCDAR2 document section\n */\nvar Core = require('../../core');\n\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.document = document;\n\n  function document(ccda) {\n    \n      var parseDate = self.doc.parseDate;\n      var parseName = self.doc.parseName;\n      var parseAddress = self.doc.parseAddress;\n      var data = {}, el;\n    \n      var doc = ccda.section('document');\n      var date = parseDate(doc.tag('effectiveTime').attr('value'));\n      var title = Core.stripWhitespace(doc.tag('title').val());\n    \n      // Parse Doc Type Info\n      var templates =  doc.elsByTag('templateId');\n      \n      var rootTemplate = templates[0].attr('root');\n      var secondTemplate;\n      if(templates.length >1)\n        secondTemplate = templates[1].attr('root');\n      else\n        secondTemplate = rootTemplate;\n    \n      var loinc = doc.tag('code').attr('code');\n      var templateId = doc.tag('templateId').attr('root');\n      var displayName = doc.tag('code').attr('displayName');\n    \n      var nonXml = doc.tag('nonXMLBody');\n      var nonXmlNodes = nonXml.el.childNodes;\n    \n      var bodyType = \"structured\";\n      var nonXmlBody = {\n        type: \"\",\n        mediaType: \"\",\n        representation: \"\",\n        rawText: \"\",\n        reference: \"\"\n      };\n      if(nonXmlNodes && nonXmlNodes.length > 0) {\n        bodyType = \"unstructured\";\n        var text = nonXml.tag('text');\n        var mediaType = \"\";\n        var representation = \"\";\n        var rawText = \"\";\n        var reference = \"\";\n        var type = \"\";\n    \n        // We have an embedded doc\n        if(text && text.attr('mediaType')) {\n          mediaType = text.attr('mediaType');\n          representation = text.attr('representation');\n          rawText = text.val();\n          type = \"embedded\";\n        }\n    \n        if(text && !mediaType) {\n          reference = text.tag('reference').attr('value');\n          type = \"reference\";\n        }\n        nonXmlBody = {\n          type: type,\n          mediaType: mediaType,\n          representation: representation,\n          rawText: rawText,\n          reference: reference\n        }\n      }\n    \n      var docType = {\n        type: \"CCDAR2\",\n        rootTemplateId: rootTemplate,\n        templateId: secondTemplate,\n        displayName: displayName,\n        loinc: loinc,\n        bodyType: bodyType,\n        nonXmlBody: nonXmlBody\n      };\n    \n      var author = doc.tag('author');\n      el = author.tag('assignedPerson').tag('name');\n      var name_dict = parseName(el);\n    \n      el = author.tag('addr');\n      var address_dict = parseAddress(el);\n    \n      el = author.tag('telecom');\n      var work_phone = el.attr('value');\n    \n      var documentation_of_list = [];\n      var performers = doc.tag('documentationOf').elsByTag('performer');\n      for (var i = 0; i < performers.length; i++) {\n        el = performers[i];\n        var performer_name_dict = parseName(el);\n        var performer_phone = el.tag('telecom').attr('value');\n        var performer_addr = parseAddress(el.tag('addr'));\n        documentation_of_list.push({\n          name: performer_name_dict,\n          phone: {\n            work: performer_phone\n          },\n          address: performer_addr\n        });\n      }\n    \n      el = doc.tag('encompassingEncounter').tag('location');\n      var location_name = Core.stripWhitespace(el.tag('name').val());\n      var location_addr_dict = parseAddress(el.tag('addr'));\n    \n      var encounter_date = null;\n      el = el.tag('effectiveTime');\n      if (!el.isEmpty()) {\n        encounter_date = parseDate(el.attr('value'));\n      }\n    \n      data = {\n        type: docType,\n        date: date,\n        title: title,\n        author: {\n          name: name_dict,\n          address: address_dict,\n          phone: {\n            work: work_phone\n          }\n        },\n        documentation_of: documentation_of_list,\n        location: {\n          name: location_name,\n          address: location_addr_dict,\n          encounter_date: encounter_date\n        }\n      };\n    \n      return data;\n    };\n}","var Core = require('../core');\nvar AllergiesParser = require('./ccda/allergies');\nvar CarePlanParser = require('./ccda/care_plan');\nvar DemographicsParser = require('./ccda/demographics');\nvar DocumentParser = require('./ccda/document');\nvar EncountersParser = require('./ccda/encounters');\nvar FreeTextParser = require('./ccda/free_text');\nvar FunctionalStatusesParser = require('./ccda/functional_statuses');\nvar ImmunizationsParser = require('./ccda/immunizations');\nvar InstructionsParser = require('./ccda/instructions');\nvar MedicationsParser = require('./ccda/medications');\nvar ProblemsParser = require('./ccda/problems');\nvar ProceduresParser = require('./ccda/procedures');\nvar ResultsParser = require('./ccda/results');\nvar SmokingStatusParser = require('./ccda/smoking_status');\nvar VitalsParser = require('./ccda/vitals');\n\nvar ParseGenericInfo = require('./generic');\n\n/*\n * Parser for the CCDA document\n */\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.allergiesParser = new AllergiesParser(self.doc);\n  self.carePlanParser = new CarePlanParser(self.doc);\n  self.demographicsParser = new DemographicsParser(self.doc);\n  self.documentParser = new DocumentParser(self.doc);\n  self.encountersParser = new EncountersParser(self.doc);\n  self.freeTextParser = new FreeTextParser();\n  self.functionalStatusesParser = new FunctionalStatusesParser(self.doc);\n  self.immunizationsParser = new ImmunizationsParser(self.doc);\n  self.instructionsParser = new InstructionsParser();\n  self.medicationsParser = new MedicationsParser(self.doc);\n  self.problemsParser = new ProblemsParser(self.doc);\n  self.proceduresParser = new ProceduresParser(self.doc);\n  self.resultsParser = new ResultsParser(self.doc);\n  self.smokingStatusParser = new SmokingStatusParser(self.doc);\n  self.vitalsParser = new VitalsParser(self.doc);\n\n\n  self.run = function (ccda) {\n    var data = {};\n    \n    data.document              = self.documentParser.document(ccda);\n    data.allergies             = self.allergiesParser.allergies(ccda);\n    data.care_plan             = self.carePlanParser.care_plan(ccda);\n    data.chief_complaint       = self.freeTextParser.free_text(ccda, 'chief_complaint');\n    data.demographics          = self.demographicsParser.demographics(ccda);\n    data.encounters            = self.encountersParser.encounters(ccda);\n    data.functional_statuses   = self.functionalStatusesParser.functional_statuses(ccda);\n    var parsedImmunizations    = self.immunizationsParser.immunizations(ccda);\n    data.immunizations         = parsedImmunizations.administered;\n    data.immunization_declines = parsedImmunizations.declined;\n    data.instructions          = self.instructionsParser.instructions(ccda);\n    data.results               = self.resultsParser.results(ccda);\n    data.medications           = self.medicationsParser.medications(ccda);\n    data.problems              = self.problemsParser.problems(ccda);\n    data.procedures            = self.proceduresParser.procedures(ccda);\n    data.smoking_status        = self.smokingStatusParser.smoking_status(ccda);\n    data.vitals                = self.vitalsParser.vitals(ccda);\n    \n    data.json                        = Core.json;\n    data.document.json               = Core.json;\n    data.allergies.json              = Core.json;\n    data.care_plan.json              = Core.json;\n    data.chief_complaint.json        = Core.json;\n    data.demographics.json           = Core.json;\n    data.encounters.json             = Core.json;\n    data.functional_statuses.json    = Core.json;\n    data.immunizations.json          = Core.json;\n    data.immunization_declines.json  = Core.json;\n    data.instructions.json           = Core.json;\n    data.results.json                = Core.json;\n    data.medications.json            = Core.json;\n    data.problems.json               = Core.json;\n    data.procedures.json             = Core.json;\n    data.smoking_status.json         = Core.json;\n    data.vitals.json                 = Core.json;\n\n    // Decorate each section with Title, templateId and text and adds missing sections\n    ParseGenericInfo(ccda, data);\n\n    return data;\n  };\n}\n","/*\n * Parser for the CCDA allergies section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  \n  self.allergies = function (ccda) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var allergies = ccda.section('allergies');\n  \n      var data = {}, el;\n      data.entries = [];\n      data.displayName = \"Allergies\";\n      data.templateId = allergies.tag('templateId').attr('root');\n      data.text = allergies.tag('text').val(true);\n    \n    allergies.entries().each(function(entry) {\n      \n      el = entry.tag('effectiveTime');\n      var start_date = parseDate(el.tag('low').attr('value')),\n          end_date = parseDate(el.tag('high').attr('value'));\n      \n      el = entry.template('2.16.840.1.113883.10.20.22.4.7').tag('code');\n      var name = el.attr('displayName'),\n          code = el.attr('code'),\n          code_system = el.attr('codeSystem'),\n          code_system_name = el.attr('codeSystemName');\n      \n      // value => reaction_type\n      el = entry.template('2.16.840.1.113883.10.20.22.4.7').tag('value');\n      var reaction_type_name = el.attr('displayName'),\n          reaction_type_code = el.attr('code'),\n          reaction_type_code_system = el.attr('codeSystem'),\n          reaction_type_code_system_name = el.attr('codeSystemName');\n      \n      // reaction\n      el = entry.template('2.16.840.1.113883.10.20.22.4.9').tag('value');\n      var reaction_name = el.attr('displayName'),\n          reaction_code = el.attr('code'),\n          reaction_code_system = el.attr('codeSystem');\n      \n      // severity\n      el = entry.template('2.16.840.1.113883.10.20.22.4.8').tag('value');\n      var severity = el.attr('displayName');\n      \n      // participant => allergen\n      el = entry.tag('participant').tag('code');\n      var allergen_name = el.attr('displayName'),\n          allergen_code = el.attr('code'),\n          allergen_code_system = el.attr('codeSystem'),\n          allergen_code_system_name = el.attr('codeSystemName');\n  \n      // this is not a valid place to store the allergen name but some vendors use it\n      if (!allergen_name) {\n        el = entry.tag('participant').tag('name');\n        if (!el.isEmpty()) {\n          allergen_name = el.val();\n        }\n      }\n      if (!allergen_name) {\n        el = entry.template('2.16.840.1.113883.10.20.22.4.7').tag('originalText');\n        if (!el.isEmpty()) {\n          allergen_name = Core.stripWhitespace(el.val());\n        }\n      }\n      \n      // status\n      el = entry.template('2.16.840.1.113883.10.20.22.4.28').tag('value');\n      var status = el.attr('displayName');\n      \n      data.entries.push({\n        date_range: {\n          start: start_date,\n          end: end_date\n        },\n        name: name,\n        code: code,\n        code_system: code_system,\n        code_system_name: code_system_name,\n        status: status,\n        severity: severity,\n        reaction: {\n          name: reaction_name,\n          code: reaction_code,\n          code_system: reaction_code_system\n        },\n        reaction_type: {\n          name: reaction_type_name,\n          code: reaction_type_code,\n          code_system: reaction_type_code_system,\n          code_system_name: reaction_type_code_system_name\n        },\n        allergen: {\n          name: allergen_name,\n          code: allergen_code,\n          code_system: allergen_code_system,\n          code_system_name: allergen_code_system_name\n        }\n      });\n    });\n    \n    return data;\n  };\n}","/*\n * Parser for the CCDA \"plan of care\" section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n    var self = this;\n    self.doc = doc;\n\n    self.care_plan = function (ccda) {        \n        var data = [], el;\n    \n        var data = {}, el;\n        care_plan = ccda.section('care_plan');\n        data.entries = [];\n        data.displayName = \"Care Plan\";\n        data.templateId = care_plan.tag('templateId').attr('root');\n        data.text = care_plan.tag('text').val(true);\n    \n        care_plan.entries().each(function (entry) {\n    \n            var name = null,\n                code = null,\n                code_system = null,\n                code_system_name = null;\n    \n            // Plan of care encounters, which have no other details\n            el = entry.template('2.16.840.1.113883.10.20.22.4.40');\n            if (!el.isEmpty()) {\n                name = 'encounter';\n            } else {\n                el = entry.tag('code');\n    \n                name = el.attr('displayName');\n                code = el.attr('code');\n                code_system = el.attr('codeSystem');\n                code_system_name = el.attr('codeSystemName');\n            }\n    \n            var text = Core.stripWhitespace(entry.tag('text').val(true));\n            var time = entry.tag('effectiveTime').immediateChildTag('center').attr('value');\n    \n            data.entries.push({\n                text: text,\n                name: name,\n                code: code,\n                code_system: code_system,\n                code_system_name: code_system_name,\n                effective_time: parse(time)\n            });\n        });\n    \n        return data;\n    \n        function parse(str) {\n            if (!str) return null;\n            var y = str.substr(0, 4),\n                m = str.substr(4, 2) - 1,\n                d = str.substr(6, 2);\n            var D = new Date(y, m, d);\n            return (D.getFullYear() == y && D.getMonth() == m && D.getDate() == d) ? D : null;\n        }\n    };\n}","/*\n * Parser for the CCDA document section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n\n  self.document = function (ccda) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var data = {}, el;\n    \n    var doc = ccda.section('document');\n  \n  \n    // Parse Doc Type Info\n    var templates =  doc.elsByTag('templateId');\n    var rootTemplate = templates[0].attr('root');\n    var secondTemplate;\n    if(templates.length >1)\n      secondTemplate = templates[1].attr('root');\n    else\n      secondTemplate = rootTemplate;\n  \n    var loinc = doc.tag('code').attr('code');\n    var templateId = doc.tag('templateId').attr('root');\n    var displayName = doc.tag('code').attr('displayName');\n  \n    var nonXml = doc.tag('nonXMLBody');\n    var nonXmlNodes = nonXml.el.childNodes;\n  \n    var bodyType = \"structured\";\n    var nonXmlBody = {\n      type: \"\",\n      mediaType: \"\",\n      representation: \"\",\n      rawText: \"\",\n      reference: \"\"\n    };\n    if(nonXmlNodes && nonXmlNodes.length > 0) {\n      bodyType = \"unstructured\";\n      var text = nonXml.tag('text');\n      var mediaType = \"\";\n      var representation = \"\";\n      var rawText = \"\";\n      var reference = \"\";\n      var type = \"\";\n  \n      // We have an embedded doc\n      if(text && text.attr('mediaType')) {\n        mediaType = text.attr('mediaType');\n        representation = text.attr('representation');\n        rawText = text.val();\n        type = \"embedded\";\n      }\n  \n      if(text && !mediaType) {\n         reference = text.tag('reference').attr('value');\n        type = \"reference\";\n      }\n      nonXmlBody = {\n        type: type,\n        mediaType: mediaType,\n        representation: representation,\n        rawText: rawText,\n        reference: reference\n      }\n    }\n  \n    var docType = {\n      type: \"CCDAR2\",\n      rootTemplateId: rootTemplate,\n      templateId: secondTemplate,\n      displayName: displayName,\n      loinc: loinc,\n      bodyType: bodyType,\n      nonXmlBody: nonXmlBody\n    };\n  \n    var date = parseDate(doc.tag('effectiveTime').attr('value'));\n    var title = Core.stripWhitespace(doc.tag('title').val());\n    \n    var author = doc.tag('author');\n    el = author.tag('assignedPerson').tag('name');\n    var name_dict = parseName(el);\n    \n    el = author.tag('addr');\n    var address_dict = parseAddress(el);\n    \n    el = author.tag('telecom');\n    var work_phone = el.attr('value');\n  \n    var documentation_of_list = [];\n    var performers = doc.tag('documentationOf').elsByTag('performer');\n    for (var i = 0; i < performers.length; i++) {\n      el = performers[i];\n      var performer_name_dict = parseName(el);\n      var performer_phone = el.tag('telecom').attr('value');\n      var performer_addr = parseAddress(el.tag('addr'));\n\n      var org = undefined;\n      var orgEl = el.tag('representedOrganization');\n      if (orgEl) {\n        org = {\n          name: orgEl.tag('name').val(),\n          phone: orgEl.tag('telecom').attr('value'),\n          address: parseAddress(orgEl.tag('addr'))\n        }\n      }\n\n      documentation_of_list.push({\n        name: performer_name_dict,\n        phone: {\n          work: performer_phone\n        },\n        address: performer_addr,\n        representedOrganization: org\n      });\n    }\n  \n    el = doc.tag('encompassingEncounter').tag('location');\n    var location_name = Core.stripWhitespace(el.tag('name').val());\n    var location_addr_dict = parseAddress(el.tag('addr'));\n    \n    var encounter_date = null;\n    el = el.tag('effectiveTime');\n    if (!el.isEmpty()) {\n      encounter_date = parseDate(el.attr('value'));\n    }\n    \n    data = {\n      type: docType,\n      date: date,\n      title: title,\n      author: {\n        name: name_dict,\n        address: address_dict,\n        phone: {\n          work: work_phone\n        }\n      },\n      documentation_of: documentation_of_list,\n      location: {\n        name: location_name,\n        address: location_addr_dict,\n        encounter_date: encounter_date\n      }\n    };\n    \n    return data;\n  };\n}","/*\n * Parser for the CCDA encounters section\n */\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n\n  self.encounters = function (ccda) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var encounters = ccda.section('encounters');\n  \n    var data = {}, el;\n    data.entries = [];\n    data.displayName = \"Encounters\";\n    data.templateId = encounters.tag('templateId').attr('root');\n    data.text = encounters.tag('text').val(true);\n    \n    encounters.entries().each(function(entry) {\n      \n      var date = parseDate(entry.tag('effectiveTime').attr('value'));\n      \n      el = entry.tag('code');\n      var name = el.attr('displayName'),\n          code = el.attr('code'),\n          code_system = el.attr('codeSystem'),\n          code_system_name = el.attr('codeSystemName'),\n          code_system_version = el.attr('codeSystemVersion');\n      \n      // translation\n      el = entry.tag('translation');\n      var translation_name = el.attr('displayName'),\n          translation_code = el.attr('code'),\n          translation_code_system = el.attr('codeSystem'),\n          translation_code_system_name = el.attr('codeSystemName');\n      \n      // performer\n      el = entry.tag('performer').tag('code');\n      var performer_name = el.attr('displayName'),\n          performer_code = el.attr('code'),\n          performer_code_system = el.attr('codeSystem'),\n          performer_code_system_name = el.attr('codeSystemName');\n    \n      // participant => location\n      el = entry.tag('participant');\n      var organization = el.tag('code').attr('displayName');\n      \n      var location_dict = parseAddress(el);\n      location_dict.organization = organization;\n  \n      // findings\n      var findings = [];\n      var findingEls = entry.elsByTag('entryRelationship');\n      for (var i = 0; i < findingEls.length; i++) {\n        el = findingEls[i].tag('value');\n        findings.push({\n          name: el.attr('displayName'),\n          code: el.attr('code'),\n          code_system: el.attr('codeSystem')\n        });\n      }\n      \n      data.entries.push({\n        date: date,\n        name: name,\n        code: code,\n        code_system: code_system,\n        code_system_name: code_system_name,\n        code_system_version: code_system_version,\n        findings: findings,\n        translation: {\n          name: translation_name,\n          code: translation_code,\n          code_system: translation_code_system,\n          code_system_name: translation_code_system_name\n        },\n        performer: {\n          name: performer_name,\n          code: performer_code,\n          code_system: performer_code_system,\n          code_system_name: performer_code_system_name\n        },\n        location: location_dict\n      });\n    });\n    \n    return data;\n  };\n}","/*\n * Parser for any freetext section (i.e., contains just a single <text> element)\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function() {\n  var self = this;\n\n  self.free_text = function (ccda, sectionName) {    \n    var data = {};\n    \n    var doc = ccda.section(sectionName);\n    var text = Core.stripWhitespace(doc.tag('text').val(true));\n    \n    data = {\n      text: text\n    };\n\n    return data;\n  };\n}\n","/*\n * Parser for the CCDA functional & cognitive status\n */\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n\n  self.functional_statuses = function (ccda) {\n    \n    var parseDate = self.doc.parseDate;\n    var data = [], el;\n  \n    var statuses = ccda.section('functional_statuses');\n  \n    statuses.entries().each(function(entry) {\n  \n      var date = parseDate(entry.tag('effectiveTime').attr('value'));\n      if (!date) {\n        date = parseDate(entry.tag('effectiveTime').tag('low').attr('value'));\n      }\n  \n      el = entry.tag('value');\n  \n      var name = el.attr('displayName'),\n          code = el.attr('code'),\n          code_system = el.attr('codeSystem'),\n          code_system_name = el.attr('codeSystemName');\n  \n      data.push({\n        date: date,\n        name: name,\n        code: code,\n        code_system: code_system,\n        code_system_name: code_system_name\n      });\n    \n    });\n    \n    return data;\n  };  \n}","/*\n * Parser for the CCDA immunizations section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n\n  self.immunizations = function (ccda) {    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var administeredData = {}, declinedData = {}, product, el;\n  \n    var immunizations = ccda.section('immunizations');\n  \n    administeredData.entries = [];\n    administeredData.displayName = \"Immunizations\";\n    administeredData.templateId = immunizations.tag('templateId').attr('root');\n    administeredData.text = immunizations.tag('text').val(true);\n  \n    declinedData.entries = [];\n    declinedData.displayName = \"Immunizations Declined\";\n    declinedData.templateId = immunizations.tag('templateId').attr('root');\n    declinedData.text = immunizations.tag('text').val(true);\n    \n    immunizations.entries().each(function(entry) {\n      \n      // date\n      el = entry.tag('effectiveTime');\n      var date = parseDate(el.attr('value'));\n      if (!date) {\n        date = parseDate(el.tag('low').attr('value'));\n      }\n  \n      // if 'declined' is true, this is a record that this vaccine WASN'T administered\n      el = entry.tag('substanceAdministration');\n      var declined = el.boolAttr('negationInd');\n  \n      // product\n      product = entry.template('2.16.840.1.113883.10.20.22.4.54');\n      el = product.tag('code');\n      var product_name = el.attr('displayName'),\n          product_code = el.attr('code'),\n          product_code_system = el.attr('codeSystem'),\n          product_code_system_name = el.attr('codeSystemName');\n  \n      // translation\n      el = product.tag('translation');\n      var translation_name = el.attr('displayName'),\n          translation_code = el.attr('code'),\n          translation_code_system = el.attr('codeSystem'),\n          translation_code_system_name = el.attr('codeSystemName');\n  \n      // misc product details\n      el = product.tag('lotNumberText');\n      var lot_number = el.val();\n  \n      el = product.tag('manufacturerOrganization');\n      var manufacturer_name = el.tag('name').val();\n      \n      // route\n      el = entry.tag('routeCode');\n      var route_name = el.attr('displayName'),\n          route_code = el.attr('code'),\n          route_code_system = el.attr('codeSystem'),\n          route_code_system_name = el.attr('codeSystemName');\n      \n      // instructions\n      el = entry.template('2.16.840.1.113883.10.20.22.4.20');\n      var instructions_text = Core.stripWhitespace(el.tag('text').val());\n      el = el.tag('code');\n      var education_name = el.attr('displayName'),\n          education_code = el.attr('code'),\n          education_code_system = el.attr('codeSystem');\n  \n      // dose\n      el = entry.tag('doseQuantity');\n      var dose_value = el.attr('value'),\n          dose_unit = el.attr('unit');\n      \n      var data = (declined) ? declinedData : administeredData;\n      data.entries.push({\n        date: date,\n        product: {\n          name: product_name,\n          code: product_code,\n          code_system: product_code_system,\n          code_system_name: product_code_system_name,\n          translation: {\n            name: translation_name,\n            code: translation_code,\n            code_system: translation_code_system,\n            code_system_name: translation_code_system_name\n          },\n          lot_number: lot_number,\n          manufacturer_name: manufacturer_name\n        },\n        dose_quantity: {\n          value: dose_value,\n          unit: dose_unit\n        },\n        route: {\n          name: route_name,\n          code: route_code,\n          code_system: route_code_system,\n          code_system_name: route_code_system_name\n        },\n        instructions: instructions_text,\n        education_type: {\n          name: education_name,\n          code: education_code,\n          code_system: education_code_system\n        }\n      });\n    });\n    \n    return {\n      administered: administeredData,\n      declined: declinedData\n    };\n  };\n}\n\n\n","/*\n * Parser for the CCDA \"plan of care\" section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function() {\n  var self = this;\n  \n  self.instructions = function (ccda) {\n    \n    var data = [], el;\n    \n    var instructions = ccda.section('instructions');\n    data.templateId = instructions.tag('templateId').attr('root');\n    \n    instructions.entries().each(function(entry) {\n  \n      el = entry.tag('code');\n      var name = el.attr('displayName'),\n          code = el.attr('code'),\n          code_system = el.attr('codeSystem'),\n          code_system_name = el.attr('codeSystemName');\n  \n      var text = Core.stripWhitespace(entry.tag('text').val(true));\n      \n      data.push({\n        text: text,\n        name: name,\n        code: code,\n        code_system: code_system,\n        code_system_name: code_system_name\n      });\n    });\n    \n    return data;\n  };\n}","/*\n * Parser for the CCDA medications section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function (doc) {\n  var self = this;\n  self.doc = doc;\n\n  self.medications = function (ccda) {\n    \n    var parseDate = self.doc.parseDate;\n    var medications = ccda.section('medications');\n  \n    var data = {}, el;\n    data.entries = [];\n    data.displayName = \"Medications\";\n    data.templateId = medications.tag('templateId').attr('root');\n    data.text = medications.tag('text').val(true);\n  \n    medications.entries().each(function(entry) {\n      \n      el = entry.tag('text');\n      var sig = Core.stripWhitespace(el.val());\n  \n      var effectiveTimes = entry.elsByTag('effectiveTime');\n  \n      el = effectiveTimes[0]; // the first effectiveTime is the med start date\n      var start_date = null, end_date = null;\n      if (el) {\n        start_date = parseDate(el.tag('low').attr('value'));\n        end_date = parseDate(el.tag('high').attr('value'));\n      }\n  \n      // the second effectiveTime might the schedule period or it might just\n      // be a random effectiveTime from further in the entry... xsi:type should tell us\n      el = effectiveTimes[1];\n      var schedule_type = null, schedule_period_value = null, schedule_period_unit = null;\n      if (el && el.attr('xsi:type') === 'PIVL_TS') {\n        var institutionSpecified = el.attr('institutionSpecified');\n        if (institutionSpecified === 'true') {\n          schedule_type= 'frequency';\n        } else if (institutionSpecified === 'false') {\n          schedule_type = 'interval';\n        }\n  \n        el = el.tag('period');\n        schedule_period_value = el.attr('value');\n        schedule_period_unit = el.attr('unit');\n      }\n      \n      el = entry.tag('manufacturedProduct').tag('code');\n      var product_name = el.attr('displayName'),\n          product_code = el.attr('code'),\n          product_code_system = el.attr('codeSystem');\n  \n      var product_original_text = null;\n      el = entry.tag('manufacturedProduct').tag('originalText');\n      if (!el.isEmpty()) {\n        product_original_text = Core.stripWhitespace(el.val());\n      }\n      // if we don't have a product name yet, try the originalText version\n      if (!product_name && product_original_text) {\n        product_name = product_original_text;\n      }\n      \n      el = entry.tag('manufacturedProduct').tag('translation');\n      var translation_name = el.attr('displayName'),\n          translation_code = el.attr('code'),\n          translation_code_system = el.attr('codeSystem'),\n          translation_code_system_name = el.attr('codeSystemName');\n      \n      el = entry.tag('doseQuantity');\n      var dose_value = el.attr('value'),\n          dose_unit = el.attr('unit');\n      \n      el = entry.tag('rateQuantity');\n      var rate_quantity_value = el.attr('value'),\n          rate_quantity_unit = el.attr('unit');\n      \n      el = entry.tag('precondition').tag('value');\n      var precondition_name = el.attr('displayName'),\n          precondition_code = el.attr('code'),\n          precondition_code_system = el.attr('codeSystem');\n      \n      el = entry.template('2.16.840.1.113883.10.20.22.4.19').tag('value');\n      var reason_name = el.attr('displayName'),\n          reason_code = el.attr('code'),\n          reason_code_system = el.attr('codeSystem');\n      \n      el = entry.tag('routeCode');\n      var route_name = el.attr('displayName'),\n          route_code = el.attr('code'),\n          route_code_system = el.attr('codeSystem'),\n          route_code_system_name = el.attr('codeSystemName');\n      \n      // participant/playingEntity => vehicle\n      el = entry.tag('participant').tag('playingEntity');\n      var vehicle_name = el.tag('name').val();\n  \n      el = el.tag('code');\n      // prefer the code vehicle_name but fall back to the non-coded one\n      vehicle_name = el.attr('displayName') || vehicle_name;\n      var vehicle_code = el.attr('code'),\n          vehicle_code_system = el.attr('codeSystem'),\n          vehicle_code_system_name = el.attr('codeSystemName');\n      \n      el = entry.tag('administrationUnitCode');\n      var administration_name = el.attr('displayName'),\n          administration_code = el.attr('code'),\n          administration_code_system = el.attr('codeSystem'),\n          administration_code_system_name = el.attr('codeSystemName');\n      \n      // performer => prescriber\n      el = entry.tag('performer');\n      var prescriber_organization = el.tag('name').val(),\n          prescriber_person = null;\n      \n      data.entries.push({\n        date_range: {\n          start: start_date,\n          end: end_date\n        },\n        text: sig,\n        product: {\n          name: product_name,\n          code: product_code,\n          code_system: product_code_system,\n          text: product_original_text,\n          translation: {\n            name: translation_name,\n            code: translation_code,\n            code_system: translation_code_system,\n            code_system_name: translation_code_system_name\n          }\n        },\n        dose_quantity: {\n          value: dose_value,\n          unit: dose_unit\n        },\n        rate_quantity: {\n          value: rate_quantity_value,\n          unit: rate_quantity_unit\n        },\n        precondition: {\n          name: precondition_name,\n          code: precondition_code,\n          code_system: precondition_code_system\n        },\n        reason: {\n          name: reason_name,\n          code: reason_code,\n          code_system: reason_code_system\n        },\n        route: {\n          name: route_name,\n          code: route_code,\n          code_system: route_code_system,\n          code_system_name: route_code_system_name\n        },\n        schedule: {\n          type: schedule_type,\n          period_value: schedule_period_value,\n          period_unit: schedule_period_unit\n        },\n        vehicle: {\n          name: vehicle_name,\n          code: vehicle_code,\n          code_system: vehicle_code_system,\n          code_system_name: vehicle_code_system_name\n        },\n        administration: {\n          name: administration_name,\n          code: administration_code,\n          code_system: administration_code_system,\n          code_system_name: administration_code_system_name\n        },\n        prescriber: {\n          organization: prescriber_organization,\n          person: prescriber_person\n        }\n      });\n    });\n    \n    return data;\n  };\n}\n","/*\n * Parser for the CCDA problems section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n\n  self.problems = function (ccda) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n  \n    var problems = ccda.section('problems');\n  \n    var data = {}, el;\n    data.entries = [];\n    data.displayName = \"Problems\";\n    data.templateId = problems.tag('templateId').attr('root');\n    data.text = problems.tag('text').val(true);\n    \n    problems.entries().each(function(entry) {\n      \n      el = entry.tag('effectiveTime');\n      var start_date = parseDate(el.tag('low').attr('value')),\n          end_date = parseDate(el.tag('high').attr('value'));\n      \n      el = entry.template('2.16.840.1.113883.10.20.22.4.4').tag('value');\n      var name = el.attr('displayName'),\n          code = el.attr('code'),\n          code_system = el.attr('codeSystem'),\n          code_system_name = el.attr('codeSystemName');\n      \n      el = entry.template('2.16.840.1.113883.10.20.22.4.4').tag('translation');\n      var translation_name = el.attr('displayName'),\n        translation_code = el.attr('code'),\n        translation_code_system = el.attr('codeSystem'),\n        translation_code_system_name = el.attr('codeSystemName');\n      \n      el = entry.template('2.16.840.1.113883.10.20.22.4.6');\n      var status = el.tag('value').attr('displayName');\n      \n      var age = null;\n      el = entry.template('2.16.840.1.113883.10.20.22.4.31');\n      if (!el.isEmpty()) {\n        age = parseFloat(el.tag('value').attr('value'));\n      }\n  \n      el = entry.template('2.16.840.1.113883.10.20.22.4.64');\n      var comment = Core.stripWhitespace(el.tag('text').val());\n      \n      data.entries.push({\n        date_range: {\n          start: start_date,\n          end: end_date\n        },\n        name: name,\n        status: status,\n        age: age,\n        code: code,\n        code_system: code_system,\n        code_system_name: code_system_name,\n        translation: {\n          name: translation_name,\n          code: translation_code,\n          code_system: translation_code_system,\n          code_system_name: translation_code_system_name\n        },\n        comment: comment\n      });\n    });\n    \n    return data;\n  };\n}\n","/*\n * Parser for the CCDA procedures section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n\n  self.procedures = function (ccda) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var procedures = ccda.section('procedures');\n  \n    var data = {}, el;\n    data.entries = [];\n    data.displayName = \"Procedures\";\n    data.templateId = procedures.tag('templateId').attr('root');\n    data.text = procedures.tag('text').val(true);\n    \n    procedures.entries().each(function(entry) {\n      \n      el = entry.tag('effectiveTime');\n      var date = parseDate(el.attr('value'));\n      \n      el = entry.tag('code');\n      var name = el.attr('displayName'),\n          code = el.attr('code'),\n          code_system = el.attr('codeSystem');\n  \n      if (!name) {\n        name = Core.stripWhitespace(entry.tag('originalText').val());\n      }\n      \n      // 'specimen' tag not always present\n      el = entry.tag('specimen').tag('code');\n      var specimen_name = el.attr('displayName'),\n          specimen_code = el.attr('code'),\n          specimen_code_system = el.attr('codeSystem');\n      \n      el = entry.tag('performer').tag('addr');\n      var organization = el.tag('name').val(),\n          phone = el.tag('telecom').attr('value');\n      \n      var performer_dict = parseAddress(el);\n      performer_dict.organization = organization;\n      performer_dict.phone = phone;\n      \n      // participant => device\n      el = entry.template('2.16.840.1.113883.10.20.22.4.37').tag('code');\n      var device_name = el.attr('displayName'),\n          device_code = el.attr('code'),\n          device_code_system = el.attr('codeSystem');\n      \n      data.entries.push({\n        date: date,\n        name: name,\n        code: code,\n        code_system: code_system,\n        specimen: {\n          name: specimen_name,\n          code: specimen_code,\n          code_system: specimen_code_system\n        },\n        performer: performer_dict,\n        device: {\n          name: device_name,\n          code: device_code,\n          code_system: device_code_system\n        }\n      });\n    });\n    \n    return data;\n  };\n}","/*\n * Parser for the CCDA results (labs) section\n */\n\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n\n  self.results = function (ccda) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var results = ccda.section('results');\n  \n    var data = {}, el;\n    data.entries = [];\n    data.displayName = \"Results\";\n    data.templateId = results.tag('templateId').attr('root');\n    data.text = results.tag('text').val(true);\n    \n    results.entries().each(function(entry) {\n      \n      // panel\n      el = entry.tag('code');\n      var panel_name = el.attr('displayName'),\n          panel_code = el.attr('code'),\n          panel_code_system = el.attr('codeSystem'),\n          panel_code_system_name = el.attr('codeSystemName');\n      \n      var observation;\n      var tests = entry.elsByTag('observation');\n      var tests_data = [];\n      \n      for (var i = 0; i < tests.length; i++) {\n        observation = tests[i];\n        \n        var date = parseDate(observation.tag('effectiveTime').attr('value'));\n        \n        el = observation.tag('code');\n        var name = el.attr('displayName'),\n            code = el.attr('code'),\n            code_system = el.attr('codeSystem'),\n            code_system_name = el.attr('codeSystemName');\n  \n        if (!name) {\n          name = Core.stripWhitespace(observation.tag('text').val());\n        }\n        \n        el = observation.tag('translation');\n        var translation_name = el.attr('displayName'),\n          translation_code = el.attr('code'),\n          translation_code_system = el.attr('codeSystem'),\n          translation_code_system_name = el.attr('codeSystemName');\n      \n        el = observation.tag('value');\n        var value = el.attr('value'),\n            unit = el.attr('unit');\n        // We could look for xsi:type=\"PQ\" (physical quantity) but it seems better\n        // not to trust that that field has been used correctly...\n        if (value && !isNaN(parseFloat(value))) {\n          value = parseFloat(value);\n        }\n        if (!value) {\n          value = el.val(); // look for free-text values\n        }\n        \n        el = observation.tag('referenceRange');\n        var reference_range_text = Core.stripWhitespace(el.tag('observationRange').tag('text').val()),\n            reference_range_low_unit = el.tag('observationRange').tag('low').attr('unit'),\n            reference_range_low_value = el.tag('observationRange').tag('low').attr('value'),\n            reference_range_high_unit = el.tag('observationRange').tag('high').attr('unit'),\n            reference_range_high_value = el.tag('observationRange').tag('high').attr('value');\n        \n        tests_data.push({\n          date: date,\n          name: name,\n          value: value,\n          unit: unit,\n          code: code,\n          code_system: code_system,\n          code_system_name: code_system_name,\n          translation: {\n            name: translation_name,\n            code: translation_code,\n            code_system: translation_code_system,\n            code_system_name: translation_code_system_name\n          },\n          reference_range: {\n            text: reference_range_text,\n            low_unit: reference_range_low_unit,\n            low_value: reference_range_low_value,\n            high_unit: reference_range_high_unit,\n            high_value: reference_range_high_value,\n          }\n        });\n      }\n      \n      data.entries.push({\n        name: panel_name,\n        code: panel_code,\n        code_system: panel_code_system,\n        code_system_name: panel_code_system_name,\n        tests: tests_data\n      });\n    });\n    \n    return data;\n  };\n}","/*\n * Parser for the CCDA smoking status in social history section\n */\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n\n  self.smoking_status = function (ccda) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var data, el;\n  \n    var name = null,\n        code = null,\n        code_system = null,\n        code_system_name = null,\n        entry_date = null;\n  \n    // We can parse all of the social_history sections,\n    // but in practice, this section seems to be used for\n    // smoking status, so we're just going to break that out.\n    // And we're just looking for the first non-empty one.\n    var social_history = ccda.section('social_history');\n    var entries = social_history.entries();\n    for (var i=0; i < entries.length; i++) {\n      var entry = entries[i];\n  \n      var smoking_status = entry.template('2.16.840.1.113883.10.20.22.4.78');\n      if (smoking_status.isEmpty()) {\n        smoking_status = entry.template('2.16.840.1.113883.10.22.4.78');\n      }\n      if (smoking_status.isEmpty()) {\n        continue;\n      }\n  \n      el = smoking_status.tag('effectiveTime');\n      entry_date = parseDate(el.attr('value'));\n  \n      el = smoking_status.tag('value');\n      name = el.attr('displayName');\n      code = el.attr('code');\n      code_system = el.attr('codeSystem');\n      code_system_name = el.attr('codeSystemName');\n  \n      if (name) {\n        break;\n      }\n    }\n  \n    data = {\n      date: entry_date,\n      name: name,\n      code: code,\n      code_system: code_system,\n      code_system_name: code_system_name\n    };\n    \n    return data;\n  };  \n}","/*\n * Parser for the CCDA vitals section\n */\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n\n  self.vitals = function (ccda) {\n    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var vitals = ccda.section('vitals');\n  \n    var data = {}, el;\n    data.entries = [];\n    data.displayName = \"Vitals\";\n    data.templateId = vitals.tag('templateId').attr('root');\n    data.text = vitals.tag('text').val(true);\n  \n    vitals.entries().each(function(entry) {\n      \n      el = entry.tag('effectiveTime');\n      var entry_date = parseDate(el.attr('value'));\n      \n      var result;\n      var results = entry.elsByTag('component');\n      var results_data = [];\n      \n      for (var i = 0; i < results.length; i++) {\n        result = results[i];\n        \n        el = result.tag('code');\n        var name = el.attr('displayName'),\n            code = el.attr('code'),\n            code_system = el.attr('codeSystem'),\n            code_system_name = el.attr('codeSystemName');\n        \n        el = result.tag('value');\n        var value = parseFloat(el.attr('value')),\n            unit = el.attr('unit');\n        \n        results_data.push({\n          name: name,\n          code: code,\n          code_system: code_system,\n          code_system_name: code_system_name,\n          value: value,\n          unit: unit\n        });\n      }\n      \n      data.entries.push({\n        date: entry_date,\n        results: results_data\n      });\n    });\n    \n    return data;\n  };\n}","/*\n * Parser for the CCDAR2 document\n */\n\nvar ParseGenericInfo = require('./generic');\nvar Core = require('../core');\n\nvar DocumentParser = require('./ccdar2/document');\nvar DemographicsParser = require('./ccda/demographics');\nvar HealthConcernsParser = require('./ccdar2/health_concerns');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n  self.documentParser = new DocumentParser(self.doc);\n  self.demographicsParser = new DemographicsParser(self.doc);\n  self.healthConcernsParser = new HealthConcernsParser(self.doc);\n\n  self.run = function (ccda) {    \n      var data = {};\n  \n      data.document              = self.documentParser.document(ccda);\n      data.demographics          = self.demographicsParser.demographics(ccda);\n      data.health_concerns_document  = self.healthConcernsParser.health_concerns_document(ccda);\n      data.json                  = Core.json;\n  \n      // Decorate each section with Title, templateId and text and adds missing sections\n      ParseGenericInfo(ccda, data);\n  \n      return data;\n    };\n}\n","/*\n * Parser for the CCDAR2 document section\n */\nvar Core = require('../../core');\n\nmodule.exports = function(doc) {\n  var self = this;\n  self.doc = doc;\n\n  self.document = function (ccda) {    \n    var parseDate = self.doc.parseDate;\n    var parseName = self.doc.parseName;\n    var parseAddress = self.doc.parseAddress;\n    var data = {}, el;\n  \n    var doc = ccda.section('document');\n    var date = parseDate(doc.tag('effectiveTime').attr('value'));\n    var title = Core.stripWhitespace(doc.tag('title').val());\n  \n    // Parse Doc Type Info\n    var templates =  doc.elsByTag('templateId');\n  \n    var rootTemplate = templates[0].attr('root');\n    var secondTemplate;\n    if(templates.length >1)\n      secondTemplate = templates[1].attr('root');\n    else\n      secondTemplate = rootTemplate;\n  \n    var loinc = doc.tag('code').attr('code');\n    var templateId = doc.tag('templateId').attr('root');\n    var displayName = doc.tag('code').attr('displayName');\n  \n    var nonXml = doc.tag('nonXMLBody');\n    var nonXmlNodes = nonXml.el.childNodes;\n  \n    var bodyType = \"structured\";\n    var nonXmlBody = {\n      type: \"\",\n      mediaType: \"\",\n      representation: \"\",\n      rawText: \"\",\n      reference: \"\"\n    };\n    if(nonXmlNodes && nonXmlNodes.length > 0) {\n      bodyType = \"unstructured\";\n      var text = nonXml.tag('text');\n      var mediaType = \"\";\n      var representation = \"\";\n      var rawText = \"\";\n      var reference = \"\";\n      var type = \"\";\n  \n      // We have an embedded doc\n      if(text && text.attr('mediaType')) {\n        mediaType = text.attr('mediaType');\n        representation = text.attr('representation');\n        rawText = text.val();\n        type = \"embedded\";\n      }\n  \n      if(text && !mediaType) {\n        reference = text.tag('reference').attr('value');\n        type = \"reference\";\n      }\n      nonXmlBody = {\n        type: type,\n        mediaType: mediaType,\n        representation: representation,\n        rawText: rawText,\n        reference: reference\n      }\n    }\n  \n    var docType = {\n      type: \"CCDAR2\",\n      rootTemplateId: rootTemplate,\n      templateId: secondTemplate,\n      displayName: displayName,\n      loinc: loinc,\n      bodyType: bodyType,\n      nonXmlBody: nonXmlBody\n    };\n  \n    var author = doc.tag('author');\n    el = author.tag('assignedPerson').tag('name');\n    var name_dict = parseName(el);\n  \n    el = author.tag('addr');\n    var address_dict = parseAddress(el);\n  \n    el = author.tag('telecom');\n    var work_phone = el.attr('value');\n  \n    var documentation_of_list = [];\n    var performers = doc.tag('documentationOf').elsByTag('performer');\n    for (var i = 0; i < performers.length; i++) {\n      el = performers[i];\n      var performer_name_dict = parseName(el);\n      var performer_phone = el.tag('telecom').attr('value');\n      var performer_addr = parseAddress(el.tag('addr'));\n      documentation_of_list.push({\n        name: performer_name_dict,\n        phone: {\n          work: performer_phone\n        },\n        address: performer_addr\n      });\n    }\n  \n    el = doc.tag('encompassingEncounter').tag('location');\n    var location_name = Core.stripWhitespace(el.tag('name').val());\n    var location_addr_dict = parseAddress(el.tag('addr'));\n  \n    var encounter_date = null;\n    el = el.tag('effectiveTime');\n    if (!el.isEmpty()) {\n      encounter_date = parseDate(el.attr('value'));\n    }\n  \n    data = {\n      type: docType,\n      date: date,\n      title: title,\n      author: {\n        name: name_dict,\n        address: address_dict,\n        phone: {\n          work: work_phone\n        }\n      },\n      documentation_of: documentation_of_list,\n      location: {\n        name: location_name,\n        address: location_addr_dict,\n        encounter_date: encounter_date\n      }\n    };\n  \n    return data;\n  };\n}"],"sourceRoot":""}